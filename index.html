<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gerente - Sistema Escolar</title>
    <!-- Links para Tailwind CSS e Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Link para Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos customizados */
        .sidebar {
            width: 250px;
        }
        .content {
            margin-left: 250px;
        }
        .hidden {
            display: none;
        }
         .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 90%; /* Altura máxima para scroll */
            overflow-y: auto; /* Adiciona scroll se o conteúdo for muito grande */
            position: relative;
        }
         .modal-container.large .modal {
             max-width: 800px; /* Aumenta o tamanho do modal para visualização de detalhes */
         }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 8px;
            color: white;
            z-index: 1002;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .notification.show {
            opacity: 1;
        }
        .notification.success {
            background-color: #4CAF50; /* Green */
        }
        .notification.error {
            background-color: #f44336; /* Red */
        }
        .notification.info {
            background-color: #2196F3; /* Blue */
        }
         .form-group {
             margin-bottom: 15px;
         }
         .form-group label {
             display: block;
             margin-bottom: 5px;
             font-weight: bold;
         }
         .form-group input,
         .form-group select,
         .form-group textarea {
             width: 100%;
             padding: 8px;
             border: 1px solid #ccc;
             border-radius: 4px;
         }
         .form-group textarea {
             min-height: 100px;
         }
         .form-group input.invalid,
         .form-group select.invalid,
         .form-group textarea.invalid {
             border-color: #f44336; /* Red border for invalid fields */
         }
         .validation-error {
             color: #f44336; /* Red text for validation messages */
             font-size: 0.875rem;
             margin-top: 5px;
         }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .report-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
        }
         .report-section h3 {
             margin-bottom: 15px;
             font-size: 1.25rem;
             font-weight: bold;
             border-bottom: 1px solid #ddd;
             padding-bottom: 10px;
         }
         .report-filters {
             margin-bottom: 20px;
             padding: 15px;
             background-color: #eef;
             border-radius: 8px;
             border: 1px solid #dde;
         }
         .report-filters label {
             font-weight: bold;
         }
         .report-filters input[type="date"] {
             padding: 5px;
             border: 1px solid #ccc;
             border-radius: 4px;
         }
         .chart-container {
             position: relative;
             height: 400px; /* Altura fixa para o gráfico */
             width: 100%;
         }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <i class="fas fa-spinner fa-spin fa-3x text-blue-600"></i>
    </div>

    <!-- Notification Area -->
    <div id="notificationArea" class="notification"></div>


    <!-- Sidebar -->
    <div class="sidebar fixed h-screen bg-gray-800 text-white flex flex-col">
        <div class="p-5 text-2xl font-bold text-center border-b border-gray-700">
            Sistema Escolar
        </div>
        <nav class="flex-grow p-5">
            <ul>
                <li class="mb-4">
                    <a href="#" id="navDashboard" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-home mr-3"></i> Dashboard
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" id="navAlunos" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-user-graduate mr-3"></i> Alunos
                    </a>
                </li>
                <li class="mb-4">
                    <a href="#" id="navProfessores" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-chalkboard-teacher mr-3"></i> Professores
                    </a>
                </li>
                 <li class="mb-4">
                    <a href="#" id="navCursos" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-book-open mr-3"></i> Cursos
                    </a>
                </li>
                 <li class="mb-4">
                    <a href="#" id="navTurmas" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-users mr-3"></i> Turmas
                    </a>
                </li>
                 <li class="mb-4">
                    <a href="#" id="navMatriculas" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-file-signature mr-3"></i> Matrículas
                    </a>
                </li>
                 <li class="mb-4">
                    <a href="#" id="navMensalidades" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-money-bill-wave mr-3"></i> Mensalidades
                    </a>
                </li>
                 <li class="mb-4">
                    <a href="#" id="navLeads" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-bullhorn mr-3"></i> Leads
                    </a>
                </li>
                 <li class="mb-4">
                    <a href="#" id="navReports" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <i class="fas fa-chart-line mr-3"></i> Relatórios
                    </a>
                </li>
            </ul>
        </nav>
        <div class="p-5 border-t border-gray-700">
            <button id="logoutButton" class="w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition duration-200">
                <i class="fas fa-sign-out-alt mr-2"></i> Sair
            </button>
        </div>
    </div>

    <!-- Page Content -->
    <div class="content p-8">
        <!-- Dashboard Section -->
        <section id="dashboardSection">
            <h2 class="text-3xl font-bold mb-6">Dashboard Gerencial</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                            <i class="fas fa-user-graduate fa-lg"></i>
                        </div>
                        <div>
                            <p class="text-gray-600">Total de Alunos</p>
                            <p id="totalAlunosCard" class="text-2xl font-bold text-gray-800">-</p>
                        </div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                            <i class="fas fa-chalkboard-teacher fa-lg"></i>
                        </div>
                        <div>
                            <p class="text-gray-600">Total de Professores</p>
                            <p id="totalProfessoresCard" class="text-2xl font-bold text-gray-800">-</p>
                        </div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                            <i class="fas fa-users fa-lg"></i>
                        </div>
                        <div>
                            <p class="text-gray-600">Total de Turmas Ativas</p>
                            <p id="totalTurmasAtivasCard" class="text-2xl font-bold text-gray-800">-</p>
                        </div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                            <i class="fas fa-bullhorn fa-lg"></i>
                        </div>
                        <div>
                            <p class="text-gray-600">Novos Leads (30 dias)</p>
                            <p id="novosLeadsCard" class="text-2xl font-bold text-gray-800">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Atividade Recente -->
            <div class="bg-white p-6 rounded-lg shadow mb-8">
                <h3 class="text-xl font-bold mb-4">Atividade Recente</h3>
                <ul id="recentActivityList" class="divide-y divide-gray-200">
                    <!-- Atividades serão carregadas aqui -->
                    <li class="py-3 text-gray-500">Nenhuma atividade recente.</li>
                </ul>
            </div>

             <!-- Adicionar Nova Atividade -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-xl font-bold mb-4">Adicionar Nova Atividade</h3>
                <form id="addActivityForm" class="flex flex-col md:flex-row md:space-x-4">
                    <div class="flex-grow form-group mb-4 md:mb-0">
                        <label for="activityDescription" class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                        <input type="text" id="activityDescription" placeholder="Ex: Novo aluno matriculado" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                         <p class="validation-error hidden" id="activityDescriptionError"></p>
                    </div>
                     <div class="form-group mb-4 md:mb-0">
                        <label for="activityType" class="block text-gray-700 text-sm font-bold mb-2">Tipo:</label>
                        <select id="activityType" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="">Selecione o Tipo</option>
                            <option value="Matrícula">Matrícula</option>
                            <option value="Financeiro">Financeiro</option>
                            <option value="Lead">Lead</option>
                            <option value="Outro">Outro</option>
                        </select>
                         <p class="validation-error hidden" id="activityTypeError"></p>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 focus:outline-none focus:shadow-outline">Adicionar Atividade</button>
                    </div>
                </form>
            </div>

        </section>

        <!-- Alunos Section -->
        <section id="alunosSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Alunos</h2>
            <div class="flex justify-between mb-4">
                <input type="text" id="searchAlunoInput" placeholder="Buscar aluno..." class="p-2 border rounded w-1/3">
                 <select id="filterAlunoStatus" class="p-2 border rounded ml-4">
                     <option value="">Todos os Status</option>
                     <option value="Ativo">Ativo</option>
                     <option value="Inativo">Inativo</option>
                     <option value="Trancado">Trancado</option>
                     <option value="Formado">Formado</option>
                 </select>
                 <div>
                     <button id="exportAlunosButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <button id="addAlunoButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Aluno
                    </button>
                 </div>
            </div>
            <div id="alunosTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Cadastro</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="alunosTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados dos alunos serão carregados aqui -->
                        <tr><td colspan="6" class="text-center py-4">Nenhum aluno encontrado.</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevAlunoPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="alunoPageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextAlunoPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

        <!-- Professores Section -->
        <section id="professoresSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Professores</h2>
             <div class="flex justify-between mb-4">
                <input type="text" id="searchProfessorInput" placeholder="Buscar professor..." class="p-2 border rounded w-1/3">
                 <select id="filterProfessorStatus" class="p-2 border rounded ml-4">
                     <option value="">Todos os Status</option>
                     <option value="Ativo">Ativo</option>
                     <option value="Inativo">Inativo</option>
                     <option value="Licença">Licença</option>
                 </select>
                 <div>
                     <button id="exportProfessoresButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <button id="addProfessorButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Professor
                    </button>
                 </div>
            </div>
            <div id="professoresTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Contratação</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="professoresTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados dos professores serão carregados aqui -->
                         <tr><td colspan="6" class="text-center py-4">Nenhum professor encontrado.</td></tr>
                    </tbody>
                </table>
            </div>
             <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevProfessorPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="professorPageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextProfessorPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

         <!-- Cursos Section -->
        <section id="cursosSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Cursos</h2>
             <div class="flex justify-between mb-4">
                <input type="text" id="searchCursoInput" placeholder="Buscar curso..." class="p-2 border rounded w-1/3">
                 <div>
                      <button id="exportCursosButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <button id="addCursoButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Curso
                    </button>
                 </div>
            </div>
            <div id="cursosTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome do Curso</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duração (horas)</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preço</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="cursosTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados dos cursos serão carregados aqui -->
                         <tr><td colspan="5" class="text-center py-4">Nenhum curso encontrado.</td></tr>
                    </tbody>
                </table>
            </div>
             <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevCursoPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="cursoPageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextCursoPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

         <!-- Turmas Section -->
        <section id="turmasSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Turmas</h2>
             <div class="flex justify-between mb-4">
                <input type="text" id="searchTurmaInput" placeholder="Buscar turma..." class="p-2 border rounded w-1/3">
                 <select id="filterTurmaCurso" class="p-2 border rounded ml-4">
                     <option value="">Todos os Cursos</option>
                     <!-- Opções de cursos serão carregadas aqui -->
                 </select>
                  <select id="filterTurmaProfessor" class="p-2 border rounded ml-4">
                     <option value="">Todos os Professores</option>
                     <!-- Opções de professores serão carregadas aqui -->
                 </select>
                  <select id="filterTurmaStatus" class="p-2 border rounded ml-4">
                     <option value="">Todos os Status</option>
                     <option value="true">Ativa</option>
                     <option value="false">Inativa</option>
                 </select>
                 <div>
                      <button id="exportTurmasButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <button id="addTurmaButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Turma
                    </button>
                 </div>
            </div>
            <div id="turmasTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome da Turma</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Curso</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Professor</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Início</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Fim</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="turmasTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados das turmas serão carregados aqui -->
                         <tr><td colspan="7" class="text-center py-4">Nenhuma turma encontrada.</td></tr>
                    </tbody>
                </table>
            </div>
             <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevTurmaPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="turmaPageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextTurmaPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

         <!-- Matrículas Section -->
        <section id="matriculasSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Matrículas</h2>
             <div class="flex justify-between mb-4">
                <input type="text" id="searchMatriculaInput" placeholder="Buscar matrícula..." class="p-2 border rounded w-1/3">
                 <select id="filterMatriculaAluno" class="p-2 border rounded ml-4">
                     <option value="">Todos os Alunos</option>
                     <!-- Opções de alunos serão carregadas aqui -->
                 </select>
                  <select id="filterMatriculaTurma" class="p-2 border rounded ml-4">
                     <option value="">Todas as Turmas</option>
                     <!-- Opções de turmas serão carregadas aqui -->
                 </select>
                  <select id="filterMatriculaStatus" class="p-2 border rounded ml-4">
                     <option value="">Todos os Status</option>
                     <option value="Ativa">Ativa</option>
                     <option value="Inativa">Inativa</option>
                     <option value="Trancada">Trancada</option>
                     <option value="Concluída">Concluída</option>
                 </select>
                 <div>
                      <button id="exportMatriculasButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <button id="addMatriculaButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Matrícula
                    </button>
                 </div>
            </div>
            <div id="matriculasTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aluno</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Turma</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data da Matrícula</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="matriculasTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados das matrículas serão carregados aqui -->
                         <tr><td colspan="5" class="text-center py-4">Nenhuma matrícula encontrada.</td></tr>
                    </tbody>
                </table>
            </div>
             <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevMatriculaPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="matriculaPageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextMatriculaPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

         <!-- Mensalidades Section -->
        <section id="mensalidadesSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Mensalidades</h2>
             <div class="flex justify-between mb-4">
                <input type="text" id="searchMensalidadeInput" placeholder="Buscar mensalidade..." class="p-2 border rounded w-1/3">
                 <select id="filterMensalidadeMatricula" class="p-2 border rounded ml-4">
                     <option value="">Todas as Matrículas</option>
                     <!-- Opções de matrículas (Aluno - Turma) serão carregadas aqui -->
                 </select>
                  <select id="filterMensalidadeStatus" class="p-2 border rounded ml-4">
                     <option value="">Todos os Status</option>
                     <option value="Pendente">Pendente</option>
                     <option value="Pago">Pago</option>
                     <option value="Vencido">Vencido</option>
                 </select>
                 <div>
                      <button id="exportMensalidadesButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <!-- Botão Adicionar Mensalidade pode ser útil para casos excepcionais -->
                    <button id="addMensalidadeButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Mensalidade
                    </button>
                 </div>
            </div>
            <div id="mensalidadesTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Matrícula (Aluno - Turma)</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Vencimento</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Pagamento</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="mensalidadesTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados das mensalidades serão carregados aqui -->
                         <tr><td colspan="6" class="text-center py-4">Nenhuma mensalidade encontrada.</td></tr>
                    </tbody>
                </table>
            </div>
             <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevMensalidadePage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="mensalidadePageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextMensalidadePage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

        <!-- Leads Section -->
        <section id="leadsSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Gerenciar Leads</h2>
             <div class="flex justify-between mb-4">
                <input type="text" id="searchLeadInput" placeholder="Buscar lead..." class="p-2 border rounded w-1/3">
                 <select id="filterLeadStatus" class="p-2 border rounded ml-4">
                     <option value="">Todos os Status</option>
                     <option value="Novo">Novo</option>
                     <option value="Em Contato">Em Contato</option>
                     <option value="Qualificado">Qualificado</option>
                     <option value="Não Qualificado">Não Qualificado</option>
                     <option value="Convertido">Convertido</option>
                 </select>
                  <select id="filterLeadCurso" class="p-2 border rounded ml-4">
                     <option value="">Todos os Cursos</option>
                     <!-- Opções de cursos serão carregadas aqui -->
                 </select>
                 <div>
                     <button id="exportLeadsButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 mr-2">
                        <i class="fas fa-file-csv mr-2"></i> Exportar CSV
                    </button>
                    <button id="addLeadButton" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i> Adicionar Lead
                    </button>
                 </div>
            </div>
            <div id="leadsTableContainer" class="bg-white p-4 rounded-lg shadow overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Curso de Interesse</th>
                            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                             <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Origem</th>
                            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="leadsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Dados dos leads serão carregados aqui -->
                         <tr><td colspan="7" class="text-center py-4">Nenhum lead encontrado.</td></tr>
                    </tbody>
                </table>
            </div>
             <div class="pagination mt-4 flex justify-between items-center">
                <button id="prevLeadPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200"><i class="fas fa-chevron-left mr-2"></i> Anterior</button>
                <span id="leadPageInfo" class="text-gray-700">Página 1 de 1 (0 itens)</span>
                <button id="nextLeadPage" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200">Próxima <i class="fas fa-chevron-right ml-2"></i></button>
            </div>
        </section>

         <!-- Reports Section -->
        <section id="reportsSection" class="hidden">
            <h2 class="text-3xl font-bold mb-6">Relatórios</h2>

            <div class="report-filters">
                <label for="reportStartDate">De:</label>
                <input type="date" id="reportStartDate">
                <label for="reportEndDate" class="ml-4">Até:</label>
                <input type="date" id="reportEndDate">
            </div>

            <!-- Relatório de Mensalidades Vencidas -->
            <div class="report-section">
                <h3 class="flex justify-between items-center">
                    Mensalidades Vencidas (No Período)
                    <span id="overdueMensalidadesCount" class="text-red-600 font-bold text-xl">-</span>
                </h3>
                <div id="overdueMensalidadesReportTableContainer" class="mt-4 bg-white p-4 rounded-lg shadow overflow-x-auto">
                     <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aluno</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Matrícula</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Vencimento</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="overdueMensalidadesReportTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Dados das mensalidades vencidas serão carregados aqui -->
                             <tr><td colspan="5" class="text-center py-4">Nenhuma mensalidade vencida encontrada para o período.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

             <!-- Relatório de Resumo Financeiro -->
            <div class="report-section">
                <h3>Resumo Financeiro (Período Selecionado)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                    <div class="bg-green-100 p-4 rounded-lg shadow">
                        <h4 class="text-lg font-semibold">Total Recebido</h4>
                        <p id="financialTotalReceived" class="text-green-700 text-2xl mt-2">-</p>
                    </div>
                     <div class="bg-yellow-100 p-4 rounded-lg shadow">
                        <h4 class="text-lg font-semibold">Total a Receber (Geral)</h4>
                        <p id="financialTotalDue" class="text-yellow-700 text-2xl mt-2">-</p>
                    </div>
                     <div class="bg-red-100 p-4 rounded-lg shadow">
                        <h4 class="text-lg font-semibold">Total Vencido (No Período)</h4>
                        <p id="financialTotalOverdue" class="text-red-700 text-2xl mt-2">-</p>
                    </div>
                </div>
            </div>

             <!-- Relatório de Tendências de Matrícula -->
            <div class="report-section">
                <h3>Tendências de Matrícula (Período Selecionado)</h3>
                 <div class="chart-container mt-4">
                    <canvas id="enrollmentTrendsChart"></canvas>
                 </div>
                 <div id="enrollmentTrendsReportTableContainer" class="mt-6 bg-white p-4 rounded-lg shadow overflow-x-auto">
                     <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mês/Ano</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Novas Matrículas</th>
                            </tr>
                        </thead>
                        <tbody id="enrollmentTrendsReportTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Dados das tendências de matrícula serão carregados aqui -->
                             <tr><td colspan="2" class="text-center py-4">Nenhum dado de matrícula encontrado para o período.</td></tr>
                        </tbody>
                    </table>
                 </div>
            </div>


        </section>


    </div>

    <!-- Modal Container for Add/Edit -->
    <div id="itemModalContainer" class="modal-container hidden">
        <div id="itemModal" class="modal">
            <span id="closeItemModalButton" class="modal-close"><i class="fas fa-times"></i></span>
            <h2 id="itemModalTitle" class="text-2xl font-bold mb-4"></h2>
            <form id="itemForm">
                <!-- Form fields will be generated here by JavaScript -->
                <div id="formFields"></div>

                <div class="flex justify-end mt-6">
                    <button type="button" id="cancelItemButton" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200 mr-2">Cancelar</button>
                    <button type="submit" id="saveItemButton" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Container for Viewing Details -->
    <div id="viewModalContainer" class="modal-container hidden large">
        <div id="viewModal" class="modal">
            <span id="closeViewModalButton" class="modal-close"><i class="fas fa-times"></i></span>
            <h2 id="viewModalTitle" class="text-2xl font-bold mb-4">Detalhes de <span id="viewItemType"></span></h2>
            <div id="viewDetailsContent" class="text-gray-700">
                <!-- Details will be loaded here -->
            </div>
             <div id="relatedRecordsContent" class="mt-6 border-t pt-4">
                 <h3 class="text-xl font-semibold mb-3">Registros Relacionados</h3>
                 <div id="relatedRecordsList">
                     <!-- Related records will be loaded here -->
                 </div>
             </div>
        </div>
    </div>


    <!-- Modal Container for Delete Confirmation -->
    <div id="deleteConfirmModalContainer" class="modal-container hidden">
        <div class="modal">
            <span id="closeDeleteModalButton" class="modal-close"><i class="fas fa-times"></i></span>
            <h2 class="text-2xl font-bold mb-4">Confirmar Exclusão</h2>
            <p id="deleteConfirmMessage" class="mb-6">Tem certeza que deseja excluir este item?</p>
            <div class="flex justify-end">
                <button type="button" id="cancelDeleteButton" class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition duration-200 mr-2">Cancelar</button>
                <button type="button" id="confirmDeleteButton" class="bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition duration-200">Excluir</button>
            </div>
        </div>
    </div>


    <script>
        // Simulação de banco de dados em memória
        let db = {
            users: [
                { id: 1, username: 'gerente', password: 'password', role: 'gerente' },
                { id: 2, username: 'professor', password: 'password', role: 'professor' },
                { id: 3, username: 'aluno', password: 'password', role: 'aluno' }
            ],
            alunos: [
                { id: 1, nome: 'Ana Silva', email: 'ana.silva@example.com', telefone: '11 98765-4321', status: 'Ativo', dataCadastro: '2023-01-15' },
                { id: 2, nome: 'Bruno Costa', email: 'bruno.costa@example.com', telefone: '21 99876-5432', status: 'Ativo', dataCadastro: '2023-01-20' },
                { id: 3, nome: 'Carla Souza', email: 'carla.souza@example.com', telefone: '31 97654-3210', status: 'Inativo', dataCadastro: '2023-02-10' },
                 { id: 4, nome: 'Daniel Pereira', email: 'daniel.pereira@example.com', telefone: '41 98888-1111', status: 'Ativo', dataCadastro: '2023-03-01' },
                 { id: 5, nome: 'Eduarda Lima', email: 'eduarda.lima@example.com', telefone: '51 97777-2222', status: 'Ativo', dataCadastro: '2023-03-10' },
                 { id: 6, nome: 'Fernando Rocha', email: 'fernando.rocha@example.com', telefone: '61 96666-3333', status: 'Trancado', dataCadastro: '2023-04-05' },
                 { id: 7, nome: 'Gabriela Martins', email: 'gabriela.martins@example.com', telefone: '71 95555-4444', status: 'Ativo', dataCadastro: '2023-05-20' },
                 { id: 8, nome: 'Hugo Fernandes', email: 'hugo.fernandes@example.com', telefone: '81 94444-5555', status: 'Formado', dataCadastro: '2022-11-01' },
                 { id: 9, nome: 'Isabela Gomes', email: 'isabela.gomes@example.com', telefone: '91 93333-6666', status: 'Ativo', dataCadastro: '2023-06-15' },
                 { id: 10, nome: 'João Almeida', email: 'joao.almeida@example.com', telefone: '11 92222-7777', status: 'Ativo', dataCadastro: '2023-07-01' },
            ],
            professores: [
                { id: 1, nome: 'Prof. Carlos Santos', email: 'carlos.santos@example.com', telefone: '11 91111-2222', status: 'Ativo', dataContratacao: '2022-08-10' },
                { id: 2, nome: 'Prof. Diana Oliveira', email: 'diana.oliveira@example.com', telefone: '21 93333-4444', status: 'Ativo', dataContratacao: '2022-09-01' },
                 { id: 3, nome: 'Prof. Eduardo Pereira', email: 'eduardo.pereira@example.com', telefone: '31 95555-6666', status: 'Inativo', dataContratacao: '2023-01-20' },
            ],
            cursos: [
                { id: 1, nome: 'Introdução à Programação', descricao: 'Curso básico de lógica e linguagens', duracaoHoras: 80, preco: 500.00 },
                { id: 2, nome: 'Desenvolvimento Web Fullstack', descricao: 'HTML, CSS, JS, Backend e Frameworks', duracaoHoras: 200, preco: 1500.00 },
                 { id: 3, nome: 'Ciência de Dados com Python', descricao: 'Análise de dados, Machine Learning', duracaoHoras: 120, preco: 1000.00 },
            ],
            turmas: [
                { id: 1, nome: 'TADS2023A', cursoId: 1, professorId: 1, dataInicio: '2023-02-01', dataFim: '2023-06-01', ativa: true },
                { id: 2, nome: 'TWEB2023B', cursoId: 2, professorId: 2, dataInicio: '2023-03-15', dataFim: '2023-11-15', ativa: true },
                 { id: 3, nome: 'TADS2023B', cursoId: 1, professorId: 1, dataInicio: '2023-08-01', dataFim: '2023-12-01', ativa: true },
                 { id: 4, nome: 'TCD2023A', cursoId: 3, professorId: 2, dataInicio: '2023-04-01', dataFim: '2023-09-01', ativa: false },
            ],
            matriculas: [
                { id: 1, alunoId: 1, turmaId: 1, dataMatricula: '2023-01-25', status: 'Ativa' },
                { id: 2, alunoId: 2, turmaId: 1, dataMatricula: '2023-01-28', status: 'Ativa' },
                { id: 3, alunoId: 4, turmaId: 2, dataMatricula: '2023-02-20', status: 'Ativa' },
                 { id: 4, alunoId: 5, turmaId: 2, dataMatricula: '2023-03-05', status: 'Ativa' },
                 { id: 5, alunoId: 7, turmaId: 3, dataMatricula: '2023-05-25', status: 'Ativa' },
                 { id: 6, alunoId: 8, turmaId: 1, dataMatricula: '2022-10-20', status: 'Concluída' },
                 { id: 7, alunoId: 9, turmaId: 3, dataMatricula: '2023-06-20', status: 'Ativa' },
                 { id: 8, alunoId: 10, turmaId: 2, dataMatricula: '2023-07-05', status: 'Ativa' },
            ],
            mensalidades: [
                // Matrícula 1 (Aluno 1, Turma 1) - 500.00 / 5 meses = 100/mês
                { id: 1, matriculaId: 1, dataVencimento: '2023-03-01', valor: 100.00, status: 'Pago', dataPagamento: '2023-02-28' },
                { id: 2, matriculaId: 1, dataVencimento: '2023-04-01', valor: 100.00, status: 'Pago', dataPagamento: '2023-03-30' },
                { id: 3, matriculaId: 1, dataVencimento: '2023-05-01', valor: 100.00, status: 'Vencido', dataPagamento: null },
                { id: 4, matriculaId: 1, dataVencimento: '2023-06-01', valor: 100.00, status: 'Vencido', dataPagamento: null },
                { id: 5, matriculaId: 1, dataVencimento: '2023-07-01', valor: 100.00, status: 'Pendente', dataPagamento: null }, // Vencimento futuro

                 // Matrícula 3 (Aluno 4, Turma 2) - 1500.00 / 9 meses = ~166.67/mês
                { id: 6, matriculaId: 3, dataVencimento: '2023-04-15', valor: 166.67, status: 'Pago', dataPagamento: '2023-04-10' },
                { id: 7, matriculaId: 3, dataVencimento: '2023-05-15', valor: 166.67, status: 'Pago', dataPagamento: '2023-05-14' },
                { id: 8, matriculaId: 3, dataVencimento: '2023-06-15', valor: 166.67, status: 'Vencido', dataPagamento: null },
                { id: 9, matriculaId: 3, dataVencimento: '2023-07-15', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 10, matriculaId: 3, dataVencimento: '2023-08-15', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 11, matriculaId: 3, dataVencimento: '2023-09-15', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 12, matriculaId: 3, dataVencimento: '2023-10-15', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 13, matriculaId: 3, dataVencimento: '2023-11-15', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 14, matriculaId: 3, dataVencimento: '2023-12-15', valor: 166.67, status: 'Pendente', dataPagamento: null }, // Vencimento futuro

                 // Matrícula 5 (Aluno 7, Turma 3) - 500.00 / 5 meses = 100/mês
                { id: 15, matriculaId: 5, dataVencimento: '2023-06-25', valor: 100.00, status: 'Pago', dataPagamento: '2023-06-24' },
                { id: 16, matriculaId: 5, dataVencimento: '2023-07-25', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 17, matriculaId: 5, dataVencimento: '2023-08-25', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 18, matriculaId: 5, dataVencimento: '2023-09-25', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 19, matriculaId: 5, dataVencimento: '2023-10-25', valor: 100.00, status: 'Pendente', dataPagamento: null }, // Vencimento futuro

                // Matrícula 7 (Aluno 9, Turma 3) - 500.00 / 5 meses = 100/mês
                { id: 20, matriculaId: 7, dataVencimento: '2023-07-20', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 21, matriculaId: 7, dataVencimento: '2023-08-20', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 22, matriculaId: 7, dataVencimento: '2023-09-20', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 23, matriculaId: 7, dataVencimento: '2023-10-20', valor: 100.00, status: 'Pendente', dataPagamento: null },
                { id: 24, matriculaId: 7, dataVencimento: '2023-11-20', valor: 100.00, status: 'Pendente', dataPagamento: null }, // Vencimento futuro

                 // Matrícula 8 (Aluno 10, Turma 2) - 1500.00 / 9 meses = ~166.67/mês
                { id: 25, matriculaId: 8, dataVencimento: '2023-08-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 26, matriculaId: 8, dataVencimento: '2023-09-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 27, matriculaId: 8, dataVencimento: '2023-10-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 28, matriculaId: 8, dataVencimento: '2023-11-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 29, matriculaId: 8, dataVencimento: '2023-12-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 30, matriculaId: 8, dataVencimento: '2024-01-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 31, matriculaId: 8, dataVencimento: '2024-02-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 32, matriculaId: 8, dataVencimento: '2024-03-05', valor: 166.67, status: 'Pendente', dataPagamento: null },
                { id: 33, matriculaId: 8, dataVencimento: '2024-04-05', valor: 166.67, status: 'Pendente', dataPagamento: null }, // Vencimento futuro

            ],
             leads: [
                { id: 1, nome: 'Pedro Rocha', email: 'pedro.rocha@example.com', telefone: '11 98765-1234', cursoInteresse: 2, status: 'Novo', origem: 'Website' },
                { id: 2, nome: 'Mariana Lima', email: 'mariana.lima@example.com', telefone: '21 99876-5678', cursoInteresse: 1, status: 'Em Contato', origem: 'Telefone' },
                 { id: 3, nome: 'Rafaela Souza', email: 'rafaela.souza@example.com', telefone: '31 97654-8765', cursoInteresse: 3, status: 'Qualificado', origem: 'Evento' },
                 { id: 4, nome: 'Thiago Oliveira', email: 'thiago.oliveira@example.com', telefone: '41 98888-9999', cursoInteresse: 2, status: 'Não Qualificado', origem: 'Website' },
                 { id: 5, nome: 'Sofia Pereira', email: 'sofia.pereira@example.com', telefone: '51 97777-0000', cursoInteresse: 1, status: 'Convertido', origem: 'Website' }, // Converted lead
            ],
            activityLog: [
                { id: 1, timestamp: '2023-07-01T10:00:00Z', description: 'Login do Gerente', type: 'Sistema' },
                { id: 2, timestamp: '2023-07-01T10:05:00Z', description: 'Aluno Ana Silva cadastrado', type: 'Matrícula' },
                 { id: 3, timestamp: '2023-07-01T10:10:00Z', description: 'Professor Carlos Santos contratado', type: 'Sistema' },
                 { id: 4, timestamp: '2023-07-02T09:00:00Z', description: 'Lead Pedro Rocha registrado', type: 'Lead' },
                 { id: 5, timestamp: '2023-07-02T11:00:00Z', description: 'Mensalidade #1 marcada como paga', type: 'Financeiro' },
            ]
        };

        // Variáveis de controle de paginação e filtro
        const itemsPerPage = 10; // Número de itens por página
        let currentAlunoPage = 1;
        let totalAlunoPages = 1;
        let currentAlunoSearchTerm = '';
        let currentFilterAlunoStatus = '';

        let currentProfessorPage = 1;
        let totalProfessorPages = 1;
        let currentProfessorSearchTerm = '';
        let currentFilterProfessorStatus = '';

        let currentCursoPage = 1;
        let totalCursoPages = 1;
        let currentCursoSearchTerm = '';

        let currentTurmaPage = 1;
        let totalTurmaPages = 1;
        let currentTurmaSearchTerm = '';
        let currentFilterTurmaCurso = '';
        let currentFilterTurmaProfessor = '';
        let currentFilterTurmaStatus = '';

        let currentMatriculaPage = 1;
        let totalMatriculaPages = 1;
        let currentMatriculaSearchTerm = '';
        let currentFilterMatriculaAluno = '';
        let currentFilterMatriculaTurma = '';
        let currentFilterMatriculaStatus = '';

        let currentMensalidadePage = 1;
        let totalMensalidadePages = 1;
        let currentMensalidadeSearchTerm = '';
        let currentFilterMensalidadeMatricula = '';
        let currentFilterMensalidadeStatus = '';

        let currentLeadPage = 1;
        let totalLeadPages = 1;
        let currentLeadSearchTerm = '';
        let currentFilterLeadStatus = '';
        let currentFilterLeadCurso = '';


        let currentItemType = null; // 'alunos', 'professores', etc.
        let currentItemId = null; // ID do item sendo editado/visualizado/excluído

        let enrollmentTrendsChart = null; // Variável para armazenar a instância do gráfico

        // --- Configuração dos campos do formulário para cada tipo de item ---
        const formFieldsConfig = {
            alunos: [
                { name: 'nome', label: 'Nome Completo', type: 'text', required: true },
                { name: 'email', label: 'Email', type: 'email', required: true },
                { name: 'telefone', label: 'Telefone', type: 'text' },
                { name: 'status', label: 'Status', type: 'select', options: ['Ativo', 'Inativo', 'Trancado', 'Formado'], required: true },
                { name: 'dataCadastro', label: 'Data de Cadastro', type: 'date', required: true, disabled: true }, // Data de cadastro não editável
            ],
            professores: [
                { name: 'nome', label: 'Nome Completo', type: 'text', required: true },
                { name: 'email', label: 'Email', type: 'email', required: true },
                { name: 'telefone', label: 'Telefone', type: 'text' },
                { name: 'status', label: 'Status', type: 'select', options: ['Ativo', 'Inativo', 'Licença'], required: true },
                { name: 'dataContratacao', label: 'Data de Contratação', type: 'date', required: true, disabled: true }, // Data de contratação não editável
            ],
            cursos: [
                { name: 'nome', label: 'Nome do Curso', type: 'text', required: true },
                { name: 'descricao', label: 'Descrição', type: 'textarea' },
                { name: 'duracaoHoras', label: 'Duração (horas)', type: 'number', required: true, min: 1 },
                { name: 'preco', label: 'Preço', type: 'number', required: true, min: 0.01, step: 0.01 },
            ],
            turmas: [
                { name: 'nome', label: 'Nome da Turma', type: 'text', required: true },
                { name: 'cursoId', label: 'Curso', type: 'select', options: [], required: true, dynamicOptions: 'cursos' }, // dynamicOptions indica que as opções vêm do BD
                { name: 'professorId', label: 'Professor', type: 'select', options: [], required: true, dynamicOptions: 'professores' },
                { name: 'dataInicio', label: 'Data de Início', type: 'date', required: true },
                { name: 'dataFim', label: 'Data de Fim', type: 'date' },
                { name: 'ativa', label: 'Turma Ativa', type: 'checkbox' },
            ],
             matriculas: [
                { name: 'alunoId', label: 'Aluno', type: 'select', options: [], required: true, dynamicOptions: 'alunos' },
                { name: 'turmaId', label: 'Turma', type: 'select', options: [], required: true, dynamicOptions: 'turmas' },
                { name: 'dataMatricula', label: 'Data da Matrícula', type: 'date', required: true, disabled: true }, // Data de matrícula não editável
                { name: 'status', label: 'Status', type: 'select', options: ['Ativa', 'Inativa', 'Trancada', 'Concluída'], required: true },
            ],
             mensalidades: [
                { name: 'matriculaId', label: 'Matrícula (Aluno - Turma)', type: 'select', options: [], required: true, dynamicOptions: 'matriculas' },
                { name: 'dataVencimento', label: 'Data de Vencimento', type: 'date', required: true },
                { name: 'valor', label: 'Valor', type: 'number', required: true, min: 0.01, step: 0.01 },
                { name: 'status', label: 'Status', type: 'select', options: ['Pendente', 'Pago', 'Vencido'], required: true },
                { name: 'dataPagamento', label: 'Data de Pagamento', type: 'date', disabled: true }, // Data de pagamento não editável pelo modal, apenas pela ação de "Marcar como Pago"
            ],
             leads: [
                { name: 'nome', label: 'Nome Completo', type: 'text', required: true },
                { name: 'email', label: 'Email', type: 'email', required: true },
                { name: 'telefone', label: 'Telefone', type: 'text' },
                { name: 'cursoInteresse', label: 'Curso de Interesse', type: 'select', options: [], dynamicOptions: 'cursos' },
                { name: 'status', label: 'Status', type: 'select', options: ['Novo', 'Em Contato', 'Qualificado', 'Não Qualificado', 'Convertido'], required: true },
                { name: 'origem', label: 'Origem', type: 'text' },
            ],
        };


        // --- Funções de Autenticação e Permissão (Simuladas) ---
        function checkAuthAndRole() {
            // Simula a verificação de autenticação (poderia vir de um cookie, localStorage, etc.)
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

            if (!loggedInUser || loggedInUser.role !== 'gerente') {
                // Redireciona para a página de login (simulada) se não for gerente
                window.location.href = 'login.html'; // Assumindo que existe uma página login.html
            } else {
                // Usuário autenticado e é gerente, mostra o conteúdo
                document.body.style.display = 'block'; // Mostra o body que estava hidden
                // Carrega os dados iniciais do dashboard
                loadDashboardData();
                 // Mostra a seção do dashboard por padrão
                showSection('dashboardSection');
            }
        }

        function handleLogout() {
            // Simula o logout removendo o usuário do localStorage
            localStorage.removeItem('loggedInUser');
            // Redireciona para a página de login (simulada)
            window.location.href = 'login.html'; // Assumindo que existe uma página login.html
        }

        // --- Funções de UI ---
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notificationArea');
            notificationArea.textContent = message;
            notificationArea.className = `notification show ${type}`; // Remove classes antigas e adiciona novas
            setTimeout(() => {
                notificationArea.classList.remove('show');
            }, 3000); // Esconde após 3 segundos
        }

        function showSection(sectionId) {
            // Esconde todas as seções
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });
            // Mostra a seção desejada
            document.getElementById(sectionId).classList.remove('hidden');

            // Atualiza o estado ativo na sidebar (opcional, mas bom para UX)
            document.querySelectorAll('.sidebar nav a').forEach(link => {
                 link.classList.remove('text-white', 'font-bold');
                 link.classList.add('text-gray-400');
            });
            const activeLink = document.getElementById(`nav${sectionId.replace('Section', '')}`);
            if (activeLink) {
                 activeLink.classList.remove('text-gray-400');
                 activeLink.classList.add('text-white', 'font-bold');
            }


            // Carrega os dados da seção mostrada
            switch (sectionId) {
                case 'dashboardSection':
                    loadDashboardData();
                    break;
                case 'alunosSection':
                    loadAlunos();
                    populateAlunoFilters();
                    break;
                case 'professoresSection':
                    loadProfessores();
                    populateProfessorFilters();
                    break;
                 case 'cursosSection':
                    loadCursos();
                    break;
                 case 'turmasSection':
                    loadTurmas();
                    populateTurmaFilters();
                    break;
                 case 'matriculasSection':
                    loadMatriculas();
                    populateMatriculaFilters();
                    break;
                 case 'mensalidadesSection':
                    loadMensalidades();
                    populateMensalidadeFilters();
                    break;
                 case 'leadsSection':
                    loadLeads();
                    populateLeadFilters();
                    break;
                 case 'reportsSection':
                    loadReports();
                    break;
            }
        }

        // --- Funções do Modal Adicionar/Editar ---
        function openAddEditModal(mode, itemType, item = null) {
            currentItemType = itemType;
            currentItemId = item ? item.id : null;
            const modalTitle = document.getElementById('itemModalTitle');
            const formFieldsDiv = document.getElementById('formFields');
            const itemForm = document.getElementById('itemForm');

            modalTitle.textContent = mode === 'add' ? `Adicionar Novo ${itemType.slice(0, -1).replace('oes', 'ão').replace('s', '')}` : `Editar ${itemType.slice(0, -1).replace('oes', 'ão').replace('s', '')}`; // Título dinâmico
            formFieldsDiv.innerHTML = ''; // Limpa campos anteriores
            clearValidationErrors(); // Limpa erros de validação anteriores

            const config = formFieldsConfig[itemType];

            config.forEach(field => {
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';

                const label = document.createElement('label');
                label.setAttribute('for', field.name);
                label.textContent = field.label + (field.required ? ' *' : ''); // Adiciona * para campos obrigatórios
                 label.className = 'block text-gray-700 text-sm font-bold mb-2';


                let inputElement;

                switch (field.type) {
                    case 'select':
                        inputElement = document.createElement('select');
                        // Popula opções dinâmicas se especificado
                        if (field.dynamicOptions) {
                            const dynamicData = db[field.dynamicOptions];
                            inputElement.innerHTML = '<option value="">Selecione...</option>'; // Opção padrão
                            dynamicData.forEach(optionItem => {
                                const option = document.createElement('option');
                                option.value = optionItem.id;
                                // Texto da opção depende do tipo de dado
                                let optionText = optionItem.nome || optionItem.descricao || `ID ${optionItem.id}`; // Default text
                                if (field.dynamicOptions === 'matriculas') {
                                     const aluno = db.alunos.find(a => a.id === optionItem.alunoId);
                                     const turma = db.turmas.find(t => t.id === optionItem.turmaId);
                                     optionText = `${aluno ? aluno.nome : 'Aluno Desconhecido'} - ${turma ? turma.nome : 'Turma Desconhecida'}`;
                                }
                                option.textContent = optionText;
                                inputElement.appendChild(option);
                            });
                        } else {
                             // Opções estáticas
                            field.options.forEach(optionValue => {
                                const option = document.createElement('option');
                                option.value = optionValue;
                                option.textContent = optionValue;
                                inputElement.appendChild(option);
                            });
                        }
                        if (item && item[field.name] !== undefined && item[field.name] !== null) {
                             // Converte para string para comparação com value do select
                            inputElement.value = String(item[field.name]);
                        }
                        break;
                    case 'textarea':
                        inputElement = document.createElement('textarea');
                        if (item) inputElement.value = item[field.name] || '';
                         inputElement.className = 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline';
                        break;
                    case 'checkbox':
                        inputElement = document.createElement('input');
                        inputElement.type = 'checkbox';
                        if (item) inputElement.checked = item[field.name] || false;
                         // Checkboxes precisam de layout diferente, ajustar Tailwind classes
                         formGroup.className = 'form-group flex items-center mb-4'; // Ajusta layout
                         label.className = 'block text-gray-700 text-sm font-bold mr-2'; // Ajusta label
                         inputElement.className = 'leading-tight'; // Ajusta input
                        break;
                    case 'number':
                        inputElement = document.createElement('input');
                        inputElement.type = 'number';
                         if (field.min !== undefined) inputElement.min = field.min;
                         if (field.max !== undefined) inputElement.max = field.max;
                         if (field.step !== undefined) inputElement.step = field.step;
                        if (item) inputElement.value = item[field.name] || '';
                         inputElement.className = 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline';
                        break;
                    case 'date':
                        inputElement = document.createElement('input');
                        inputElement.type = 'date';
                        if (item && item[field.name]) {
                             // Formata a data para 'YYYY-MM-DD' para inputs type="date"
                            const date = new Date(item[field.name]);
                            inputElement.value = date.toISOString().split('T')[0];
                        } else {
                            inputElement.value = ''; // Valor padrão vazio para 'add'
                        }
                         inputElement.className = 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline';
                         if (field.disabled) {
                             inputElement.disabled = true;
                             inputElement.classList.add('bg-gray-200', 'cursor-not-allowed');
                         }
                        break;
                    default: // text, email, etc.
                        inputElement = document.createElement('input');
                        inputElement.type = field.type;
                        if (item) inputElement.value = item[field.name] || '';
                         inputElement.className = 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline';
                }

                inputElement.id = field.name;
                inputElement.name = field.name; // Adiciona name para facilitar a serialização (opcional aqui, mas boa prática)
                 if (field.required && field.type !== 'checkbox') { // Checkbox required handled differently
                     inputElement.setAttribute('required', '');
                 }


                formGroup.appendChild(label);
                 if (field.type === 'checkbox') { // Adiciona input antes da label para layout flex
                     formGroup.appendChild(inputElement);
                     formGroup.appendChild(label); // Adiciona label depois do input
                 } else {
                     formGroup.appendChild(inputElement);
                 }


                 // Adiciona placeholder para mensagem de erro de validação
                 const errorElement = document.createElement('p');
                 errorElement.id = `${field.name}Error`;
                 errorElement.className = 'validation-error hidden';
                 formGroup.appendChild(errorElement);


                formFieldsDiv.appendChild(formGroup);
            });

            document.getElementById('itemModalContainer').classList.remove('hidden');
        }


        function closeItemModal() {
            document.getElementById('itemModalContainer').classList.add('hidden');
            document.getElementById('itemForm').reset(); // Limpa o formulário
            clearValidationErrors(); // Limpa erros de validação ao fechar
            currentItemType = null;
            currentItemId = null;
        }

        function clearValidationErrors() {
             document.querySelectorAll('.validation-error').forEach(el => {
                 el.textContent = '';
                 el.classList.add('hidden');
             });
             document.querySelectorAll('input, select, textarea').forEach(el => {
                 el.classList.remove('invalid');
             });
        }

         function displayValidationError(fieldId, message) {
             const errorElement = document.getElementById(`${fieldId}Error`);
             const inputElement = document.getElementById(fieldId);
             if (errorElement && inputElement) {
                 errorElement.textContent = message;
                 errorElement.classList.remove('hidden');
                 inputElement.classList.add('invalid');
             }
         }


        async function handleItemFormSubmit(event) {
            event.preventDefault();
            showLoading();
            clearValidationErrors(); // Limpa erros antes de validar novamente

            const form = event.target;
            const formData = new FormData(form);
            const newItem = {};
            let isValid = true;

            // Obter a configuração de campos para o tipo atual
            const config = formFieldsConfig[currentItemType];

            // Coletar dados e validar
            config.forEach(field => {
                let value;
                if (field.type === 'checkbox') {
                    value = form.elements[field.name].checked;
                } else {
                    value = form.elements[field.name].value.trim();
                }

                // Validação de campos obrigatórios
                if (field.required && !value && field.type !== 'checkbox') {
                    displayValidationError(field.name, `${field.label} é obrigatório.`);
                    isValid = false;
                }

                 // Validação de email
                 if (field.type === 'email' && value && !/\S+@\S+\.\S+/.test(value)) {
                     displayValidationError(field.name, `Formato de email inválido.`);
                     isValid = false;
                 }

                 // Validação de número
                 if (field.type === 'number' && value !== '') { // Permite campo vazio se não for required
                     const numValue = parseFloat(value);
                     if (isNaN(numValue)) {
                         displayValidationError(field.name, `${field.label} deve ser um número.`);
                         isValid = false;
                     } else {
                         if (field.min !== undefined && numValue < field.min) {
                             displayValidationError(field.name, `${field.label} deve ser no mínimo ${field.min}.`);
                             isValid = false;
                         }
                         if (field.max !== undefined && numValue > field.max) {
                             displayValidationError(field.name, `${field.label} deve ser no máximo ${field.max}.`);
                             isValid = false;
                         }
                         value = numValue; // Converte para número se válido
                     }
                 }

                 // Validação de data (formato básico)
                 if (field.type === 'date' && value && !/^\d{4}-\d{2}-\d{2}$/.test(value)) {
                     displayValidationError(field.name, `Formato de data inválido (AAAA-MM-DD).`);
                     isValid = false;
                 }


                // Converter IDs de select para número, exceto se for string pura (como status)
                if (field.type === 'select' && field.dynamicOptions && value !== '') {
                     value = parseInt(value, 10);
                }


                newItem[field.name] = value;
            });

            if (!isValid) {
                hideLoading();
                showNotification('Por favor, corrija os erros no formulário.', 'error');
                return; // Interrompe a submissão se houver erros
            }


            try {
                if (currentItemId === null) {
                    // Modo Adicionar
                     // Adiciona campos padrão para novos itens, se necessário
                     if (currentItemType === 'alunos') {
                         newItem.dataCadastro = new Date().toISOString().split('T')[0]; // Data atual
                     } else if (currentItemType === 'professores') {
                         newItem.dataContratacao = new Date().toISOString().split('T')[0]; // Data atual
                     } else if (currentItemType === 'matriculas') {
                         newItem.dataMatricula = new Date().toISOString().split('T')[0]; // Data atual
                         // Gerar mensalidades automaticamente para a nova matrícula
                         generateMensalidadesForMatricula(newItem);
                     } else if (currentItemType === 'mensalidades') {
                          // Para mensalidades adicionadas manualmente, dataPagamento é null por padrão
                         newItem.dataPagamento = null;
                     }


                    await addItem(currentItemType, newItem);
                    showNotification(`${currentItemType.slice(0, -1).replace('oes', 'ão').replace('s', '')} adicionado(a) com sucesso!`, 'success');
                } else {
                    // Modo Editar
                    // Mantém campos desabilitados com seus valores originais se não foram alterados
                    config.forEach(field => {
                        if (field.disabled && form.elements[field.name].disabled) {
                             // Se o campo estava desabilitado, usa o valor original do item
                            const originalItem = db[currentItemType].find(item => item.id === currentItemId);
                            if (originalItem) {
                                newItem[field.name] = originalItem[field.name];
                            }
                        }
                    });

                    await updateItem(currentItemType, currentItemId, newItem);
                    showNotification(`${currentItemType.slice(0, -1).replace('oes', 'ão').replace('s', '')} atualizado(a) com sucesso!`, 'success');
                }

                closeItemModal();
                // Recarrega a lista da seção atual
                loadSectionData(currentItemType);
                 // Recarrega o dashboard e relatórios se necessário
                 if (currentItemType === 'alunos' || currentItemType === 'professores' || currentItemType === 'turmas' || currentItemType === 'leads') {
                    loadDashboardData();
                 }
                 if (currentItemType === 'matriculas' || currentItemType === 'mensalidades') {
                     loadReports(); // Recarrega relatórios financeiros e de matrícula
                 }


            } catch (error) {
                console.error('Erro ao salvar item:', error);
                showNotification(`Erro ao salvar ${currentItemType.slice(0, -1).replace('oes', 'ão').replace('s', '')}.`, 'error');
            } finally {
                hideLoading();
            }
        }

        // Função auxiliar para recarregar dados da seção ativa
        function loadSectionData(itemType) {
            switch (itemType) {
                case 'alunos': loadAlunos(); break;
                case 'professores': loadProfessores(); break;
                case 'cursos': loadCursos(); break;
                case 'turmas': loadTurmas(); break;
                case 'matriculas': loadMatriculas(); break;
                case 'mensalidades': loadMensalidades(); break;
                case 'leads': loadLeads(); break;
            }
        }


        // --- Funções do Modal Visualizar Detalhes ---
         function openViewModal(itemType, item) {
             const viewModalContainer = document.getElementById('viewModalContainer');
             const viewModalTitle = document.getElementById('viewModalTitle');
             const viewItemTypeSpan = document.getElementById('viewItemType');
             const viewDetailsContent = document.getElementById('viewDetailsContent');
             const relatedRecordsContent = document.getElementById('relatedRecordsContent');
             const relatedRecordsList = document.getElementById('relatedRecordsList');

             viewItemTypeSpan.textContent = itemType.slice(0, -1).replace('oes', 'ão').replace('s', '');
             viewDetailsContent.innerHTML = ''; // Limpa conteúdo anterior
             relatedRecordsList.innerHTML = ''; // Limpa conteúdo anterior
             relatedRecordsContent.classList.add('hidden'); // Esconde a seção de relacionados por padrão


             // Renderiza os detalhes do item
             const detailList = document.createElement('dl');
             detailList.className = 'divide-y divide-gray-200';

             const config = formFieldsConfig[itemType];

             config.forEach(field => {
                 const dt = document.createElement('dt');
                 dt.className = 'px-4 py-2 text-sm font-medium text-gray-500 md:w-1/3 md:flex-shrink-0';
                 dt.textContent = field.label;

                 const dd = document.createElement('dd');
                 dd.className = 'mt-1 px-4 py-2 text-sm text-gray-900 sm:mt-0 md:col-span-2';

                 let value = item[field.name];

                 // Formata o valor para exibição
                 if (field.type === 'date' && value) {
                     value = new Date(value).toLocaleDateString('pt-BR');
                 } else if (field.type === 'number') {
                      if (field.name === 'preco' || field.name === 'valor') {
                          value = value !== undefined && value !== null ? `R$ ${value.toFixed(2).replace('.', ',')}` : '-';
                      } else {
                          value = value !== undefined && value !== null ? value : '-';
                      }
                 } else if (field.type === 'checkbox') {
                     value = value ? 'Sim' : 'Não';
                 } else if (field.type === 'select' && field.dynamicOptions) {
                     // Busca o nome do item relacionado
                     const relatedItem = db[field.dynamicOptions].find(rel => rel.id === value);
                      if (field.dynamicOptions === 'matriculas' && relatedItem) {
                         const aluno = db.alunos.find(a => a.id === relatedItem.alunoId);
                         const turma = db.turmas.find(t => t.id === relatedItem.turmaId);
                         value = `${aluno ? aluno.nome : 'Aluno Desconhecido'} - ${turma ? turma.nome : 'Turma Desconhecida'}`;
                     } else {
                         value = relatedItem ? (relatedItem.nome || relatedItem.descricao || `ID ${value}`) : `ID Desconhecido (${value})`;
                     }
                 } else {
                     value = value || '-'; // Exibe '-' se o valor for null, undefined ou vazio
                 }


                 dd.textContent = value;

                 const detailItem = document.createElement('div');
                 detailItem.className = 'md:grid md:grid-cols-3 md:gap-4';
                 detailItem.appendChild(dt);
                 detailItem.appendChild(dd);

                 detailList.appendChild(detailItem);
             });

             viewDetailsContent.appendChild(detailList);

             // Carrega e exibe registros relacionados
             loadRelatedRecords(itemType, item.id);


             viewModalContainer.classList.remove('hidden');
         }

         function closeViewModal() {
             document.getElementById('viewModalContainer').classList.add('hidden');
             document.getElementById('viewDetailsContent').innerHTML = '';
             document.getElementById('relatedRecordsList').innerHTML = '';
         }

         function loadRelatedRecords(itemType, itemId) {
             const relatedRecordsList = document.getElementById('relatedRecordsList');
             const relatedRecordsContent = document.getElementById('relatedRecordsContent');
             relatedRecordsList.innerHTML = ''; // Limpa lista anterior

             let related = [];
             let title = '';
             let displayFields = []; // Campos a serem exibidos na lista relacionada

             switch (itemType) {
                 case 'alunos':
                     related = db.matriculas.filter(m => m.alunoId === itemId);
                     title = 'Matrículas';
                     displayFields = ['turmaId', 'dataMatricula', 'status']; // Exibir Turma, Data, Status
                     break;
                 case 'professores':
                     related = db.turmas.filter(t => t.professorId === itemId);
                     title = 'Turmas Ministradas';
                     displayFields = ['nome', 'cursoId', 'dataInicio', 'ativa']; // Exibir Nome, Curso, Data Início, Ativa
                     break;
                 case 'cursos':
                     related = db.turmas.filter(t => t.cursoId === itemId);
                     title = 'Turmas deste Curso';
                     displayFields = ['nome', 'professorId', 'dataInicio', 'ativa']; // Exibir Nome, Professor, Data Início, Ativa
                     break;
                 case 'turmas':
                     related = db.matriculas.filter(m => m.turmaId === itemId);
                     title = 'Alunos Matriculados';
                     displayFields = ['alunoId', 'dataMatricula', 'status']; // Exibir Aluno, Data Matrícula, Status
                     break;
                 case 'matriculas':
                     related = db.mensalidades.filter(m => m.matriculaId === itemId);
                     title = 'Mensalidades desta Matrícula';
                     displayFields = ['dataVencimento', 'valor', 'status', 'dataPagamento']; // Exibir Data Vencimento, Valor, Status, Data Pagamento
                     break;
                  case 'leads':
                      // Para leads, podemos mostrar cursos de interesse (já mostrado nos detalhes) ou talvez atividades relacionadas (se tivéssemos um log por lead)
                      // Por enquanto, não há registros relacionados diretos para leads.
                      related = [];
                      title = 'Nenhum registro relacionado direto.';
                      break;
                 default:
                     related = [];
                     title = 'Nenhum registro relacionado.';
             }

             if (related.length > 0) {
                  relatedRecordsContent.classList.remove('hidden'); // Mostra a seção
                 relatedRecordsContent.querySelector('h3').textContent = title;

                 const relatedListElement = document.createElement('ul');
                 relatedListElement.className = 'divide-y divide-gray-200';

                 related.forEach(record => {
                     const listItem = document.createElement('li');
                     listItem.className = 'py-3 text-sm text-gray-700';
                     let itemText = [];

                     displayFields.forEach(field => {
                         let value = record[field];
                         let label = field; // Usar nome do campo como label temporário

                         // Formatação e busca de nomes para IDs
                         if (field === 'alunoId') {
                             const aluno = db.alunos.find(a => a.id === value);
                             value = aluno ? aluno.nome : 'Aluno Desconhecido';
                             label = 'Aluno';
                         } else if (field === 'turmaId') {
                             const turma = db.turmas.find(t => t.id === value);
                             value = turma ? turma.nome : 'Turma Desconhecida';
                             label = 'Turma';
                         } else if (field === 'cursoId') {
                             const curso = db.cursos.find(c => c.id === value);
                             value = curso ? curso.nome : 'Curso Desconhecido';
                             label = 'Curso';
                         } else if (field === 'professorId') {
                             const professor = db.professores.find(p => p.id === value);
                             value = professor ? professor.nome : 'Professor Desconhecido';
                             label = 'Professor';
                         } else if (field === 'dataMatricula' || field === 'dataInicio' || field === 'dataVencimento' || field === 'dataPagamento') {
                              value = value ? new Date(value).toLocaleDateString('pt-BR') : '-';
                              label = label.replace('data', 'Data'); // Capitaliza
                         } else if (field === 'valor') {
                              value = value !== undefined && value !== null ? `R$ ${value.toFixed(2).replace('.', ',')}` : '-';
                              label = 'Valor';
                         } else if (field === 'ativa') {
                             value = value ? 'Sim' : 'Não';
                             label = 'Ativa';
                         } else {
                              label = label.charAt(0).toUpperCase() + label.slice(1); // Capitaliza o nome do campo
                         }

                         itemText.push(`<strong>${label}:</strong> ${value}`);
                     });

                     listItem.innerHTML = itemText.join(' | ');
                     relatedListElement.appendChild(listItem);
                 });

                 relatedRecordsList.appendChild(relatedListElement);

             } else {
                  relatedRecordsContent.classList.remove('hidden'); // Mostra a seção mesmo que vazia
                  relatedRecordsContent.querySelector('h3').textContent = title; // Exibe a mensagem de "Nenhum registro..."
             }

         }


        // --- Funções do Modal Confirmar Exclusão ---
         function openDeleteConfirmModal(itemType, itemId) {
             currentItemType = itemType;
             currentItemId = itemId;
             const deleteConfirmMessage = document.getElementById('deleteConfirmMessage');
             deleteConfirmMessage.textContent = `Tem certeza que deseja excluir este(a) ${itemType.slice(0, -1).replace('oes', 'ão').replace('s', '')}? Esta ação não pode ser desfeita.`;
             document.getElementById('deleteConfirmModalContainer').classList.remove('hidden');
         }

         function closeDeleteConfirmModal() {
             document.getElementById('deleteConfirmModalContainer').classList.add('hidden');
             currentItemType = null;
             currentItemId = null;
         }

         async function handleConfirmDelete() {
             if (currentItemType && currentItemId !== null) {
                 showLoading();
                 try {
                     await deleteItem(currentItemType, currentItemId);
                     showNotification(`${currentItemType.slice(0, -1).replace('oes', 'ão').replace('s', '')} excluído(a) com sucesso!`, 'success');
                     closeDeleteConfirmModal();
                     // Recarrega a lista da seção atual
                     loadSectionData(currentItemType);
                      // Recarrega o dashboard e relatórios se necessário
                      if (currentItemType === 'alunos' || currentItemType === 'professores' || currentItemType === 'turmas' || currentItemType === 'leads') {
                         loadDashboardData();
                      }
                      if (currentItemType === 'matriculas' || currentItemType === 'mensalidades') {
                          loadReports(); // Recarrega relatórios financeiros e de matrícula
                      }

                 } catch (error) {
                     console.error('Erro ao excluir item:', error);
                     showNotification(`Erro ao excluir ${currentItemType.slice(0, -1).replace('oes', 'ão').replace('s', '')}.`, 'error');
                 } finally {
                     hideLoading();
                 }
             }
         }


        // --- Funções de Simulação de API (CRUD) ---
        async function fetchItems(itemType, page = 1, searchTerm = '', filters = {}) {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 300)); // Simula delay da API

            let items = db[itemType];
            if (!items) {
                console.error(`Tipo de item desconhecido: ${itemType}`);
                hideLoading();
                return { data: [], totalItems: 0 };
            }

            // Aplicar busca
            if (searchTerm) {
                const lowerSearchTerm = searchTerm.toLowerCase();
                items = items.filter(item =>
                    Object.values(item).some(value =>
                        value !== null && value !== undefined && String(value).toLowerCase().includes(lowerSearchTerm)
                    )
                );
            }

            // Aplicar filtros
            items = items.filter(item => {
                let match = true;
                for (const key in filters) {
                    const filterValue = filters[key];
                    if (filterValue !== '' && filterValue !== undefined && filterValue !== null) {
                         // Tratamento especial para booleanos (checkboxes)
                        if (typeof item[key] === 'boolean') {
                            if (String(item[key]) !== String(filterValue)) {
                                match = false;
                                break;
                            }
                        } else if (item[key] !== undefined && item[key] !== null) {
                             // Comparação case-insensitive para strings, ou comparação direta para outros tipos
                             if (typeof item[key] === 'string') {
                                 if (!item[key].toLowerCase().includes(String(filterValue).toLowerCase())) {
                                     match = false;
                                     break;
                                 }
                             } else {
                                  // Converte ambos para string para comparação, útil para IDs
                                  if (String(item[key]) !== String(filterValue)) {
                                     match = false;
                                     break;
                                 }
                             }
                        } else if (filterValue !== '') { // Se o item não tem o campo mas o filtro está ativo
                             match = false;
                             break;
                        }
                    }
                }
                return match;
            });


            const totalItems = items.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const paginatedItems = items.slice(startIndex, startIndex + itemsPerPage);

            hideLoading();
            return { data: paginatedItems, totalItems: totalItems, totalPages: totalPages };
        }

        async function addItem(itemType, item) {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 300)); // Simula delay da API

            if (!db[itemType]) {
                console.error(`Tipo de item desconhecido: ${itemType}`);
                hideLoading();
                throw new Error(`Tipo de item desconhecido: ${itemType}`);
            }

            // Gera um novo ID (simples, apenas para simulação)
            const newId = db[itemType].length > 0 ? Math.max(...db[itemType].map(i => i.id)) + 1 : 1;
            const newItem = { id: newId, ...item };

            db[itemType].push(newItem);

             // Adiciona atividade ao log
             let activityDesc = `Novo(a) ${itemType.slice(0, -1).replace('oes', 'ão').replace('s', '')} adicionado(a).`;
             let activityType = 'Sistema';
             if (itemType === 'alunos') activityType = 'Matrícula';
             if (itemType === 'leads') activityType = 'Lead';
             if (itemType === 'mensalidades') activityType = 'Financeiro';
             addActivityToLog(activityDesc, activityType);


            hideLoading();
            return newItem;
        }

        async function updateItem(itemType, id, updatedItem) {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 300)); // Simula delay da API

            if (!db[itemType]) {
                console.error(`Tipo de item desconhecido: ${itemType}`);
                hideLoading();
                throw new Error(`Tipo de item desconhecido: ${itemType}`);
            }

            const index = db[itemType].findIndex(item => item.id === id);
            if (index === -1) {
                console.error(`Item com ID ${id} não encontrado em ${itemType}`);
                hideLoading();
                throw new Error(`Item com ID ${id} não encontrado`);
            }

            // Mescla o item existente com os dados atualizados
            db[itemType][index] = { ...db[itemType][index], ...updatedItem };

             // Adiciona atividade ao log
             let activityDesc = `${itemType.slice(0, -1).replace('oes', 'ão').replace('s', '')} ID ${id} atualizado(a).`;
              if (itemType === 'mensalidades' && updatedItem.status === 'Pago' && db[itemType][index].status !== 'Pago') {
                 activityDesc = `Mensalidade ID ${id} marcada como paga.`;
                 activityType = 'Financeiro';
             } else {
                  activityType = 'Sistema';
             }
             addActivityToLog(activityDesc, activityType);


            hideLoading();
            return db[itemType][index];
        }

        async function deleteItem(itemType, id) {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 300)); // Simula delay da API

            if (!db[itemType]) {
                console.error(`Tipo de item desconhecido: ${itemType}`);
                hideLoading();
                throw new Error(`Tipo de item desconhecido: ${itemType}`);
            }

            const initialLength = db[itemType].length;
            db[itemType] = db[itemType].filter(item => item.id !== id);

            if (db[itemType].length === initialLength) {
                console.error(`Item com ID ${id} não encontrado em ${itemType}`);
                hideLoading();
                throw new Error(`Item com ID ${id} não encontrado`);
            }

             // Adiciona atividade ao log
             const activityDesc = `${itemType.slice(0, -1).replace('oes', 'ão').replace('s', '')} ID ${id} excluído(a).`;
             addActivityToLog(activityDesc, 'Sistema');


            hideLoading();
            return { success: true };
        }

         // Função para adicionar atividade ao log
         function addActivityToLog(description, type = 'Sistema') {
             const newId = db.activityLog.length > 0 ? Math.max(...db.activityLog.map(a => a.id)) + 1 : 1;
             const newActivity = {
                 id: newId,
                 timestamp: new Date().toISOString(),
                 description: description,
                 type: type
             };
             db.activityLog.push(newActivity);
             // Mantém o log ordenado por data (mais recente primeiro)
             db.activityLog.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
             // Limita o log a um número razoável de entradas (opcional)
             // db.activityLog = db.activityLog.slice(0, 50);
             // Recarrega a lista de atividades se estiver no dashboard
             if (!document.getElementById('dashboardSection').classList.contains('hidden')) {
                 renderRecentActivity();
             }
         }


        // --- Funções de Geração de Mensalidades (Simulada) ---
         function generateMensalidadesForMatricula(matricula) {
             const turma = db.turmas.find(t => t.id === matricula.turmaId);
             const curso = db.cursos.find(c => c.id === turma.cursoId);

             if (!turma || !curso || !turma.dataInicio || !turma.dataFim || !curso.preco) {
                 console.warn(`Não foi possível gerar mensalidades para a matrícula ${matricula.id}. Dados incompletos.`);
                 return;
             }

             const startDate = new Date(turma.dataInicio);
             const endDate = new Date(turma.dataFim);
             let monthsDiff = (endDate.getFullYear() - startDate.getFullYear()) * 12;
             monthsDiff -= startDate.getMonth();
             monthsDiff += endDate.getMonth();
             monthsDiff = Math.max(0, monthsDiff + 1); // Inclui o mês final

             if (monthsDiff <= 0) {
                 console.warn(`Duração da turma ${turma.id} inválida para gerar mensalidades.`);
                 return;
             }

             const valorMensal = curso.preco / monthsDiff;

             for (let i = 0; i < monthsDiff; i++) {
                 const vencimentoDate = new Date(startDate);
                 vencimentoDate.setMonth(startDate.getMonth() + i);
                 // Define o dia do vencimento, por exemplo, dia 1 do mês
                 vencimentoDate.setDate(1);
                 // Ajusta para o próximo mês se a data de início for no final do mês
                 if (startDate.getDate() > 28 && vencimentoDate.getDate() !== startDate.getDate()) {
                      vencimentoDate.setDate(startDate.getDate());
                      // Se ainda assim o dia for inválido (ex: 31 de fev), vai para o último dia do mês
                      if (vencimentoDate.getMonth() !== (startDate.getMonth() + i) % 12) {
                          vencimentoDate.setDate(0); // Vai para o último dia do mês anterior, que é o último dia do mês correto
                      }
                 }


                 const newMensalidade = {
                     id: db.mensalidades.length > 0 ? Math.max(...db.mensalidades.map(m => m.id)) + 1 : 1,
                     matriculaId: matricula.id,
                     dataVencimento: vencimentoDate.toISOString().split('T')[0],
                     valor: parseFloat(valorMensal.toFixed(2)), // Arredonda para 2 casas decimais
                     status: 'Pendente',
                     dataPagamento: null
                 };
                 db.mensalidades.push(newMensalidade);
             }
             console.log(`Geradas ${monthsDiff} mensalidades para a matrícula ${matricula.id}.`);
         }


         // --- Funções de Ação Específica (Marcar Mensalidade como Paga) ---
         async function markMensalidadeAsPaid(mensalidadeId) {
             showLoading();
             await new Promise(resolve => setTimeout(resolve, 300)); // Simula delay

             const mensalidadeIndex = db.mensalidades.findIndex(m => m.id === mensalidadeId);

             if (mensalidadeIndex === -1) {
                 hideLoading();
                 showNotification('Mensalidade não encontrada.', 'error');
                 return;
             }

             const mensalidade = db.mensalidades[mensalidadeIndex];

             if (mensalidade.status === 'Pago') {
                 hideLoading();
                 showNotification('Esta mensalidade já está paga.', 'info');
                 return;
             }

             // Atualiza o status e a data de pagamento
             mensalidade.status = 'Pago';
             mensalidade.dataPagamento = new Date().toISOString().split('T')[0]; // Data atual do pagamento

             // Simula a atualização no "banco de dados"
             db.mensalidades[mensalidadeIndex] = mensalidade;

             // Adiciona atividade ao log
             addActivityToLog(`Mensalidade ID ${mensalidadeId} marcada como paga.`, 'Financeiro');


             hideLoading();
             showNotification('Mensalidade marcada como paga com sucesso!', 'success');

             // Recarrega a tabela de mensalidades e os relatórios
             loadMensalidades();
             loadReports();
         }


        // --- Funções de Renderização de Tabelas ---
        async function loadAlunos() {
            const alunosTableBody = document.getElementById('alunosTableBody');
            const alunoPageInfo = document.getElementById('alunoPageInfo');
            const prevAlunoPage = document.getElementById('prevAlunoPage');
            const nextAlunoPage = document.getElementById('nextAlunoPage');

            const filters = { status: currentFilterAlunoStatus };
            const result = await fetchItems('alunos', currentAlunoPage, currentAlunoSearchTerm, filters);
            const alunos = result.data;
            const totalItems = result.totalItems;
            totalAlunoPages = result.totalPages;

            alunosTableBody.innerHTML = ''; // Limpa a tabela

            if (alunos.length === 0) {
                alunosTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">Nenhum aluno encontrado.</td></tr>';
            } else {
                alunos.forEach(aluno => {
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${aluno.nome}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${aluno.email}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${aluno.telefone || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${aluno.status}</td>
                             <td class="px-6 py-4 whitespace-nowrap">${new Date(aluno.dataCadastro).toLocaleDateString('pt-BR')}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button onclick="openViewModal('alunos', ${aluno.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                <button onclick="openAddEditModal('edit', 'alunos', ${aluno.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('alunos', ${aluno.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    alunosTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            alunoPageInfo.textContent = `Página ${currentAlunoPage} de ${totalAlunoPages} (${totalItems} itens)`;
            prevAlunoPage.disabled = currentAlunoPage === 1;
            nextAlunoPage.disabled = currentAlunoPage === totalAlunoPages || totalAlunoPages === 0;
        }

        async function loadProfessores() {
            const professoresTableBody = document.getElementById('professoresTableBody');
            const professorPageInfo = document.getElementById('professorPageInfo');
            const prevProfessorPage = document.getElementById('prevProfessorPage');
            const nextProfessorPage = document.getElementById('nextProfessorPage');

            const filters = { status: currentFilterProfessorStatus };
            const result = await fetchItems('professores', currentProfessorPage, currentProfessorSearchTerm, filters);
            const professores = result.data;
            const totalItems = result.totalItems;
            totalProfessorPages = result.totalPages;

            professoresTableBody.innerHTML = ''; // Limpa a tabela

            if (professores.length === 0) {
                professoresTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">Nenhum professor encontrado.</td></tr>';
            } else {
                professores.forEach(professor => {
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${professor.nome}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${professor.email}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${professor.telefone || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${professor.status}</td>
                             <td class="px-6 py-4 whitespace-nowrap">${new Date(professor.dataContratacao).toLocaleDateString('pt-BR')}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                 <button onclick="openViewModal('professores', ${professor.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                <button onclick="openAddEditModal('edit', 'professores', ${professor.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('professores', ${professor.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    professoresTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            professorPageInfo.textContent = `Página ${currentProfessorPage} de ${totalProfessorPages} (${totalItems} itens)`;
            prevProfessorPage.disabled = currentProfessorPage === 1;
            nextProfessorPage.disabled = currentProfessorPage === totalProfessorPages || totalProfessorPages === 0;
        }

         async function loadCursos() {
            const cursosTableBody = document.getElementById('cursosTableBody');
            const cursoPageInfo = document.getElementById('cursoPageInfo');
            const prevCursoPage = document.getElementById('prevCursoPage');
            const nextCursoPage = document.getElementById('nextCursoPage');

            const result = await fetchItems('cursos', currentCursoPage, currentCursoSearchTerm);
            const cursos = result.data;
            const totalItems = result.totalItems;
            totalCursoPages = result.totalPages;

            cursosTableBody.innerHTML = ''; // Limpa a tabela

            if (cursos.length === 0) {
                cursosTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4">Nenhum curso encontrado.</td></tr>';
            } else {
                cursos.forEach(curso => {
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${curso.nome}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${curso.descricao || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${curso.duracaoHoras}</td>
                             <td class="px-6 py-4 whitespace-nowrap">R$ ${curso.preco.toFixed(2).replace('.', ',')}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                 <button onclick="openViewModal('cursos', ${curso.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                <button onclick="openAddEditModal('edit', 'cursos', ${curso.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('cursos', ${curso.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    cursosTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            cursoPageInfo.textContent = `Página ${currentCursoPage} de ${totalCursoPages} (${totalItems} itens)`;
            prevCursoPage.disabled = currentCursoPage === 1;
            nextCursoPage.disabled = currentCursoPage === totalCursoPages || totalCursoPages === 0;
        }

         async function loadTurmas() {
            const turmasTableBody = document.getElementById('turmasTableBody');
            const turmaPageInfo = document.getElementById('turmaPageInfo');
            const prevTurmaPage = document.getElementById('prevTurmaPage');
            const nextTurmaPage = document.getElementById('nextTurmaPage');

            const filters = {
                 cursoId: currentFilterTurmaCurso ? parseInt(currentFilterTurmaCurso, 10) : '', // Converte para número
                 professorId: currentFilterTurmaProfessor ? parseInt(currentFilterTurmaProfessor, 10) : '', // Converte para número
                 ativa: currentFilterTurmaStatus !== '' ? (currentFilterTurmaStatus === 'true') : '' // Converte para boolean ou mantém vazio
            };
            const result = await fetchItems('turmas', currentTurmaPage, currentTurmaSearchTerm, filters);
            const turmas = result.data;
            const totalItems = result.totalItems;
            totalTurmaPages = result.totalPages;

            turmasTableBody.innerHTML = ''; // Limpa a tabela

            if (turmas.length === 0) {
                turmasTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Nenhuma turma encontrada.</td></tr>';
            } else {
                turmas.forEach(turma => {
                    const curso = db.cursos.find(c => c.id === turma.cursoId);
                    const professor = db.professores.find(p => p.id === turma.professorId);
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${turma.nome}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${curso ? curso.nome : 'Curso Desconhecido'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${professor ? professor.nome : 'Professor Desconhecido'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${turma.dataInicio ? new Date(turma.dataInicio).toLocaleDateString('pt-BR') : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${turma.dataFim ? new Date(turma.dataFim).toLocaleDateString('pt-BR') : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${turma.ativa ? 'Ativa' : 'Inativa'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                 <button onclick="openViewModal('turmas', ${turma.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                <button onclick="openAddEditModal('edit', 'turmas', ${turma.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('turmas', ${turma.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    turmasTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            turmaPageInfo.textContent = `Página ${currentTurmaPage} de ${totalTurmaPages} (${totalItems} itens)`;
            prevTurmaPage.disabled = currentTurmaPage === 1;
            nextTurmaPage.disabled = currentTurmaPage === totalTurmaPages || totalTurmaPages === 0;
        }

         async function loadMatriculas() {
            const matriculasTableBody = document.getElementById('matriculasTableBody');
            const matriculaPageInfo = document.getElementById('matriculaPageInfo');
            const prevMatriculaPage = document.getElementById('prevMatriculaPage');
            const nextMatriculaPage = document.getElementById('nextMatriculaPage');

             const filters = {
                 alunoId: currentFilterMatriculaAluno ? parseInt(currentFilterMatriculaAluno, 10) : '', // Converte para número
                 turmaId: currentFilterMatriculaTurma ? parseInt(currentFilterMatriculaTurma, 10) : '', // Converte para número
                 status: currentFilterMatriculaStatus
            };
             // Note: Busca por texto não é aplicada no fetch simulado para esta coleção no momento
            const result = await fetchItems('matriculas', currentMatriculaPage, '', filters);
            const matriculas = result.data;
            const totalItems = result.totalItems;
            totalMatriculaPages = result.totalPages;

            matriculasTableBody.innerHTML = ''; // Limpa a tabela

            if (matriculas.length === 0) {
                matriculasTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4">Nenhuma matrícula encontrada.</td></tr>';
            } else {
                matriculas.forEach(matricula => {
                    const aluno = db.alunos.find(a => a.id === matricula.alunoId);
                    const turma = db.turmas.find(t => t.id === matricula.turmaId);
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${aluno ? aluno.nome : 'Aluno Desconhecido'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${turma ? turma.nome : 'Turma Desconhecida'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${new Date(matricula.dataMatricula).toLocaleDateString('pt-BR')}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${matricula.status}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                 <button onclick="openViewModal('matriculas', ${matricula.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                <button onclick="openAddEditModal('edit', 'matriculas', ${matricula.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('matriculas', ${matricula.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    matriculasTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            matriculaPageInfo.textContent = `Página ${currentMatriculaPage} de ${totalMatriculaPages} (${totalItems} itens)`;
            prevMatriculaPage.disabled = currentMatriculaPage === 1;
            nextMatriculaPage.disabled = currentMatriculaPage === totalMatriculaPages || totalMatriculaPages === 0;
        }


         async function loadMensalidades() {
            const mensalidadesTableBody = document.getElementById('mensalidadesTableBody');
            const mensalidadePageInfo = document.getElementById('mensalidadePageInfo');
            const prevMensalidadePage = document.getElementById('prevMensalidadePage');
            const nextMensalidadePage = document.getElementById('nextMensalidadePage');

             const filters = {
                 matriculaId: currentFilterMensalidadeMatricula ? parseInt(currentFilterMensalidadeMatricula, 10) : '', // Converte para número
                 status: currentFilterMensalidadeStatus
            };
             // Note: Busca por texto não é aplicada no fetch simulado para esta coleção no momento
            const result = await fetchItems('mensalidades', currentMensalidadePage, '', filters);
            const mensalidades = result.data;
            const totalItems = result.totalItems;
            totalMensalidadePages = result.totalPages;

            mensalidadesTableBody.innerHTML = ''; // Limpa a tabela

            if (mensalidades.length === 0) {
                mensalidadesTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4">Nenhuma mensalidade encontrada.</td></tr>';
            } else {
                mensalidades.forEach(mensalidade => {
                    const matricula = db.matriculas.find(m => m.id === mensalidade.matriculaId);
                    const aluno = matricula ? db.alunos.find(a => a.id === matricula.alunoId) : null;
                    const turma = matricula ? db.turmas.find(t => t.id === matricula.turmaId) : null;

                    const matriculaInfo = matricula ? `${aluno ? aluno.nome : 'Aluno Desconhecido'} - ${turma ? turma.nome : 'Turma Desconhecida'}` : 'Matrícula Desconhecida';

                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${matriculaInfo}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${new Date(mensalidade.dataVencimento).toLocaleDateString('pt-BR')}</td>
                            <td class="px-6 py-4 whitespace-nowrap">R$ ${mensalidade.valor.toFixed(2).replace('.', ',')}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${mensalidade.status}</td>
                             <td class="px-6 py-4 whitespace-nowrap">${mensalidade.dataPagamento ? new Date(mensalidade.dataPagamento).toLocaleDateString('pt-BR') : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                 <button onclick="openViewModal('mensalidades', ${mensalidade.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                ${mensalidade.status !== 'Pago' ?
                                    `<button onclick="markMensalidadeAsPaid(${mensalidade.id})" class="text-green-600 hover:text-green-900 mr-3"><i class="fas fa-check-circle"></i> Pagar</button>`
                                    : ''}
                                <button onclick="openAddEditModal('edit', 'mensalidades', ${mensalidade.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('mensalidades', ${mensalidade.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    mensalidadesTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            mensalidadePageInfo.textContent = `Página ${currentMensalidadePage} de ${totalMensalidadePages} (${totalItems} itens)`;
            prevMensalidadePage.disabled = currentMensalidadePage === 1;
            nextMensalidadePage.disabled = currentMensalidadePage === totalMensalidadePages || totalMensalidadePages === 0;
        }


         async function loadLeads() {
            const leadsTableBody = document.getElementById('leadsTableBody');
            const leadPageInfo = document.getElementById('leadPageInfo');
            const prevLeadPage = document.getElementById('prevLeadPage');
            const nextLeadPage = document.getElementById('nextLeadPage');

            const filters = {
                 status: currentFilterLeadStatus,
                 cursoInteresse: currentFilterLeadCurso ? parseInt(currentFilterLeadCurso, 10) : '' // Converte para número
            };
            const result = await fetchItems('leads', currentLeadPage, currentLeadSearchTerm, filters);
            const leads = result.data;
            const totalItems = result.totalItems;
            totalLeadPages = result.totalPages;

            leadsTableBody.innerHTML = ''; // Limpa a tabela

            if (leads.length === 0) {
                leadsTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Nenhum lead encontrado.</td></tr>';
            } else {
                leads.forEach(lead => {
                    const curso = db.cursos.find(c => c.id === lead.cursoInteresse);
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${lead.nome}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${lead.email}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${lead.telefone || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${curso ? curso.nome : 'Não especificado'}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${lead.status}</td>
                             <td class="px-6 py-4 whitespace-nowrap">${lead.origem || '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                 <button onclick="openViewModal('leads', ${lead.id})" class="text-blue-600 hover:text-blue-900 mr-3"><i class="fas fa-eye"></i> Visualizar</button>
                                <button onclick="openAddEditModal('edit', 'leads', ${lead.id})" class="text-indigo-600 hover:text-indigo-900 mr-3"><i class="fas fa-edit"></i> Editar</button>
                                <button onclick="openDeleteConfirmModal('leads', ${lead.id})" class="text-red-600 hover:text-red-900"><i class="fas fa-trash-alt"></i> Excluir</button>
                            </td>
                        </tr>
                    `;
                    leadsTableBody.innerHTML += row;
                });
            }

            // Atualiza informações de paginação
            leadPageInfo.textContent = `Página ${currentLeadPage} de ${totalLeadPages} (${totalItems} itens)`;
            prevLeadPage.disabled = currentLeadPage === 1;
            nextLeadPage.disabled = currentLeadPage === totalLeadPages || totalLeadPages === 0;
        }


        // --- Funções de População de Filtros ---
        async function populateAlunoFilters() {
             const filterAlunoStatusSelect = document.getElementById('filterAlunoStatus');
             // As opções de status são estáticas, não precisam ser carregadas do DB
             // Se fossem dinâmicas, faríamos um fetch aqui
        }

         async function populateProfessorFilters() {
             const filterProfessorStatusSelect = document.getElementById('filterProfessorStatus');
             // As opções de status são estáticas
         }

         async function populateTurmaFilters() {
             const filterTurmaCursoSelect = document.getElementById('filterTurmaCurso');
             const filterTurmaProfessorSelect = document.getElementById('filterTurmaProfessor');
             const filterTurmaStatusSelect = document.getElementById('filterTurmaStatus');

             // Popula cursos
             const cursos = await fetchItems('cursos');
             filterTurmaCursoSelect.innerHTML = '<option value="">Todos os Cursos</option>';
             cursos.data.forEach(curso => {
                 const option = document.createElement('option');
                 option.value = curso.id;
                 option.textContent = curso.nome;
                 filterTurmaCursoSelect.appendChild(option);
             });
             filterTurmaCursoSelect.value = currentFilterTurmaCurso; // Mantém o filtro selecionado

             // Popula professores
             const professores = await fetchItems('professores');
             filterTurmaProfessorSelect.innerHTML = '<option value="">Todos os Professores</option>';
             professores.data.forEach(professor => {
                 const option = document.createElement('option');
                 option.value = professor.id;
                 option.textContent = professor.nome;
                 filterTurmaProfessorSelect.appendChild(option);
             });
              filterTurmaProfessorSelect.value = currentFilterTurmaProfessor; // Mantém o filtro selecionado

              // Popula status (estático)
              filterTurmaStatusSelect.value = currentFilterTurmaStatus; // Mantém o filtro selecionado
         }

         async function populateMatriculaFilters() {
             const filterMatriculaAlunoSelect = document.getElementById('filterMatriculaAluno');
             const filterMatriculaTurmaSelect = document.getElementById('filterMatriculaTurma');
             const filterMatriculaStatusSelect = document.getElementById('filterMatriculaStatus');

             // Popula alunos
             const alunos = await fetchItems('alunos');
             filterMatriculaAlunoSelect.innerHTML = '<option value="">Todos os Alunos</option>';
             alunos.data.forEach(aluno => {
                 const option = document.createElement('option');
                 option.value = aluno.id;
                 option.textContent = aluno.nome;
                 filterMatriculaAlunoSelect.appendChild(option);
             });
             filterMatriculaAlunoSelect.value = currentFilterMatriculaAluno; // Mantém o filtro selecionado


             // Popula turmas
             const turmas = await fetchItems('turmas');
             filterMatriculaTurmaSelect.innerHTML = '<option value="">Todas as Turmas</option>';
             turmas.data.forEach(turma => {
                 const option = document.createElement('option');
                 option.value = turma.id;
                 option.textContent = turma.nome;
                 filterMatriculaTurmaSelect.appendChild(option);
             });
             filterMatriculaTurmaSelect.value = currentFilterMatriculaTurma; // Mantém o filtro selecionado

              // Popula status (estático)
             filterMatriculaStatusSelect.value = currentFilterMatriculaStatus; // Mantém o filtro selecionado
         }

         async function populateMensalidadeFilters() {
             const filterMensalidadeMatriculaSelect = document.getElementById('filterMensalidadeMatricula');
             const filterMensalidadeStatusSelect = document.getElementById('filterMensalidadeStatus');

             // Popula matrículas (Aluno - Turma)
             const matriculas = await fetchItems('matriculas');
             filterMensalidadeMatriculaSelect.innerHTML = '<option value="">Todas as Matrículas</option>';
             matriculas.data.forEach(matricula => {
                 const aluno = db.alunos.find(a => a.id === matricula.alunoId);
                 const turma = db.turmas.find(t => t.id === matricula.turmaId);
                 const option = document.createElement('option');
                 option.value = matricula.id;
                 option.textContent = `${aluno ? aluno.nome : 'Aluno Desconhecido'} - ${turma ? turma.nome : 'Turma Desconhecida'}`;
                 filterMensalidadeMatriculaSelect.appendChild(option);
             });
             filterMensalidadeMatriculaSelect.value = currentFilterMensalidadeMatricula; // Mantém o filtro selecionado

              // Popula status (estático)
             filterMensalidadeStatusSelect.value = currentFilterMensalidadeStatus; // Mantém o filtro selecionado
         }

         async function populateLeadFilters() {
             const filterLeadStatusSelect = document.getElementById('filterLeadStatus');
             const filterLeadCursoSelect = document.getElementById('filterLeadCurso');

             // Popula status (estático)
             filterLeadStatusSelect.value = currentFilterLeadStatus; // Mantém o filtro selecionado

             // Popula cursos
             const cursos = await fetchItems('cursos');
             filterLeadCursoSelect.innerHTML = '<option value="">Todos os Cursos</option>';
             cursos.data.forEach(curso => {
                 const option = document.createElement('option');
                 option.value = curso.id;
                 option.textContent = curso.nome;
                 filterLeadCursoSelect.appendChild(option);
             });
             filterLeadCursoSelect.value = currentFilterLeadCurso; // Mantém o filtro selecionado
         }


        // --- Funções do Dashboard ---
        async function loadDashboardData() {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 300)); // Simula delay

            // Contagem de itens
            document.getElementById('totalAlunosCard').textContent = db.alunos.length;
            document.getElementById('totalProfessoresCard').textContent = db.professores.length;
            document.getElementById('totalTurmasAtivasCard').textContent = db.turmas.filter(t => t.ativa).length;

            // Novos Leads (últimos 30 dias - simulação)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
             // Como não temos data de criação para leads, vamos simular contando todos os leads com status 'Novo'
            document.getElementById('novosLeadsCard').textContent = db.leads.filter(lead => lead.status === 'Novo').length;

            // Atividade Recente
            renderRecentActivity();

            hideLoading();
        }

         function renderRecentActivity() {
             const recentActivityList = document.getElementById('recentActivityList');
             recentActivityList.innerHTML = ''; // Limpa a lista

             const recentActivities = db.activityLog.slice(0, 5); // Exibe as 5 atividades mais recentes

             if (recentActivities.length === 0) {
                 recentActivityList.innerHTML = '<li class="py-3 text-gray-500">Nenhuma atividade recente.</li>';
             } else {
                 recentActivities.forEach(activity => {
                     const listItem = document.createElement('li');
                     listItem.className = 'py-3 flex justify-between items-center';
                     const timestamp = new Date(activity.timestamp).toLocaleString('pt-BR');
                     listItem.innerHTML = `
                        <span>${activity.description} <span class="text-gray-500 text-sm">- ${activity.type}</span></span>
                        <span class="text-gray-500 text-sm">${timestamp}</span>
                     `;
                     recentActivityList.appendChild(listItem);
                 });
             }
         }

         async function handleAddActivitySubmit(event) {
             event.preventDefault();
             showLoading();

             const descriptionInput = document.getElementById('activityDescription');
             const typeSelect = document.getElementById('activityType');
             const descriptionError = document.getElementById('activityDescriptionError');
             const typeError = document.getElementById('activityTypeError');

             // Limpa erros anteriores
             descriptionError.textContent = '';
             descriptionError.classList.add('hidden');
             typeError.textContent = '';
             typeError.classList.add('hidden');
             descriptionInput.classList.remove('invalid');
             typeSelect.classList.remove('invalid');

             const description = descriptionInput.value.trim();
             const type = typeSelect.value;

             let isValid = true;

             if (!description) {
                 displayValidationError('activityDescription', 'A descrição é obrigatória.');
                 isValid = false;
             }
             if (!type) {
                  displayValidationError('activityType', 'O tipo é obrigatório.');
                  isValid = false;
             }

             if (!isValid) {
                 hideLoading();
                 showNotification('Por favor, preencha todos os campos obrigatórios.', 'error');
                 return;
             }

             try {
                 // Adiciona a atividade diretamente ao log simulado
                 addActivityToLog(description, type);

                 showNotification('Atividade adicionada com sucesso!', 'success');
                 event.target.reset(); // Limpa o formulário
                 renderRecentActivity(); // Atualiza a lista no dashboard

             } catch (error) {
                 console.error('Erro ao adicionar atividade:', error);
                 showNotification('Erro ao adicionar atividade.', 'error');
             } finally {
                 hideLoading();
             }
         }


        // --- Funções de Relatórios ---
        function setDefaultReportDates() {
            const reportStartDateInput = document.getElementById('reportStartDate');
            const reportEndDateInput = document.getElementById('reportEndDate');

            const today = new Date();
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0); // Último dia do mês atual
            const startOfYear = new Date(today.getFullYear(), 0, 1); // Primeiro dia do ano atual

            reportEndDateInput.value = endOfMonth.toISOString().split('T')[0];
            reportStartDateInput.value = startOfYear.toISOString().split('T')[0];
        }

        async function loadReports() {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, 500)); // Simula delay

            const reportStartDate = document.getElementById('reportStartDate').value;
            const reportEndDate = document.getElementById('reportEndDate').value;

            const startDate = reportStartDate ? new Date(reportStartDate) : null;
            const endDate = reportEndDate ? new Date(reportEndDate) : null;

            // Ajusta a data final para incluir o dia inteiro
             if (endDate) {
                 endDate.setHours(23, 59, 59, 999);
             }


            // --- Relatório de Mensalidades Vencidas (No Período) ---
            const overdueMensalidadesReportTableBody = document.getElementById('overdueMensalidadesReportTableBody');
            const overdueMensalidadesCountSpan = document.getElementById('overdueMensalidadesCount');

            const overdueMensalidades = db.mensalidades.filter(m => {
                const vencimentoDate = new Date(m.dataVencimento);
                 // Filtra vencidas (status 'Vencido') E com data de vencimento dentro do período OU antes do fim do período se vencida antes
                 return m.status === 'Vencido' &&
                        (!startDate || vencimentoDate >= startDate) &&
                        (!endDate || vencimentoDate <= endDate);
            });

            overdueMensalidadesReportTableBody.innerHTML = '';
            if (overdueMensalidades.length === 0) {
                overdueMensalidadesReportTableBody.innerHTML = '<tr><td colspan="5" class="text-center py-4">Nenhuma mensalidade vencida encontrada para o período.</td></tr>';
            } else {
                overdueMensalidades.forEach(mensalidade => {
                     const matricula = db.matriculas.find(m => m.id === mensalidade.matriculaId);
                     const aluno = matricula ? db.alunos.find(a => a.id === matricula.alunoId) : null;
                     const turma = matricula ? db.turmas.find(t => t.id === matricula.turmaId) : null;
                     const matriculaInfo = matricula ? `${aluno ? aluno.nome : 'Aluno Desconhecido'} - ${turma ? turma.nome : 'Turma Desconhecida'}` : 'Matrícula Desconhecida';

                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${matriculaInfo}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${new Date(mensalidade.dataVencimento).toLocaleDateString('pt-BR')}</td>
                            <td class="px-6 py-4 whitespace-nowrap">R$ ${mensalidade.valor.toFixed(2).replace('.', ',')}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${mensalidade.status}</td>
                             <td class="px-6 py-4 whitespace-nowrap">${mensalidade.dataPagamento ? new Date(mensalidade.dataPagamento).toLocaleDateString('pt-BR') : '-'}</td>
                        </tr>
                    `;
                    overdueMensalidadesReportTableBody.innerHTML += row;
                });
            }
            overdueMensalidadesCountSpan.textContent = overdueMensalidades.length;


            // --- Relatório de Resumo Financeiro (Período Selecionado) ---
            const financialTotalReceivedSpan = document.getElementById('financialTotalReceived');
            const financialTotalDueSpan = document.getElementById('financialTotalDue');
            const financialTotalOverdueSpan = document.getElementById('financialTotalOverdue');

            let totalReceived = 0;
            let totalDue = 0;
            let totalOverdue = 0;

            db.mensalidades.forEach(m => {
                const vencimentoDate = new Date(m.dataVencimento);
                 const pagamentoDate = m.dataPagamento ? new Date(m.dataPagamento) : null;

                 // Total Recebido: status 'Pago' E dataPagamento dentro do período
                 if (m.status === 'Pago' && pagamentoDate &&
                     (!startDate || pagamentoDate >= startDate) &&
                     (!endDate || pagamentoDate <= endDate)) {
                     totalReceived += m.valor;
                 }

                 // Total a Receber (Geral): status 'Pendente' (independente do período)
                 if (m.status === 'Pendente') {
                     totalDue += m.valor;
                 }

                 // Total Vencido (No Período): status 'Vencido' E dataVencimento dentro do período
                  if (m.status === 'Vencido' &&
                     (!startDate || vencimentoDate >= startDate) &&
                     (!endDate || vencimentoDate <= endDate)) {
                     totalOverdue += m.valor;
                 }
            });

            financialTotalReceivedSpan.textContent = `R$ ${totalReceived.toFixed(2).replace('.', ',')}`;
            financialTotalDueSpan.textContent = `R$ ${totalDue.toFixed(2).replace('.', ',')}`;
            financialTotalOverdueSpan.textContent = `R$ ${totalOverdue.toFixed(2).replace('.', ',')}`;


            // --- Relatório de Tendências de Matrícula (Período Selecionado) ---
            const enrollmentTrendsChartCanvas = document.getElementById('enrollmentTrendsChart');
            const enrollmentTrendsReportTableBody = document.getElementById('enrollmentTrendsReportTableBody');

            const enrollmentsInPeriod = db.matriculas.filter(m => {
                const matriculaDate = new Date(m.dataMatricula);
                return (!startDate || matriculaDate >= startDate) &&
                       (!endDate || matriculaDate <= endDate);
            });

            // Agrupar matrículas por mês/ano
            const monthlyEnrollments = enrollmentsInPeriod.reduce((acc, matricula) => {
                const date = new Date(matricula.dataMatricula);
                const monthYear = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`; // YYYY-MM
                acc[monthYear] = (acc[monthYear] || 0) + 1;
                return acc;
            }, {});

            // Ordenar meses e preparar dados para o gráfico e tabela
            const sortedMonths = Object.keys(monthlyEnrollments).sort();
            const chartLabels = sortedMonths.map(my => {
                 const [year, month] = my.split('-');
                 return `${month}/${year}`; // Formato MM/YYYY para exibição
            });
            const chartData = sortedMonths.map(my => monthlyEnrollments[my]);

            // Destruir gráfico anterior se existir
            if (enrollmentTrendsChart) {
                enrollmentTrendsChart.destroy();
            }

            // Renderizar gráfico
            enrollmentTrendsChart = new Chart(enrollmentTrendsChartCanvas, {
                type: 'bar', // Pode ser 'line' também
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Novas Matrículas',
                        data: chartData,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Permite controlar a altura com CSS
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Número de Matrículas'
                            },
                             ticks: {
                                 stepSize: 1 // Garante que o eixo Y mostre apenas números inteiros
                             }
                        },
                         x: {
                             title: {
                                 display: true,
                                 text: 'Mês/Ano'
                             }
                         }
                    },
                    plugins: {
                        legend: {
                            display: false // Oculta a legenda se houver apenas um dataset
                        },
                        title: {
                            display: true,
                            text: 'Tendência Mensal de Matrículas'
                        }
                    }
                }
            });

            // Renderizar tabela de tendências
            enrollmentTrendsReportTableBody.innerHTML = '';
            if (sortedMonths.length === 0) {
                 enrollmentTrendsReportTableBody.innerHTML = '<tr><td colspan="2" class="text-center py-4">Nenhum dado de matrícula encontrado para o período.</td></tr>';
            } else {
                sortedMonths.forEach(monthYear => {
                    const count = monthlyEnrollments[monthYear];
                     const [year, month] = monthYear.split('-');
                     const displayMonthYear = `${month}/${year}`;
                    const row = `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">${displayMonthYear}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${count}</td>
                        </tr>
                    `;
                    enrollmentTrendsReportTableBody.innerHTML += row;
                });
            }


            hideLoading();
        }


        // --- Funções de Exportação CSV ---
         function exportToCSV(filename, data) {
            const csvRows = [];
            // Cabeçalho
            const headers = Object.keys(data[0]);
            csvRows.push(headers.join(';')); // Usar ponto e vírgula como separador

            // Dados
            for (const row of data) {
                const values = headers.map(header => {
                    const value = row[header];
                    // Tratar valores nulos/undefined e formatar datas/números se necessário
                    if (value === null || value === undefined) {
                        return '';
                    }
                     if (value instanceof Date) {
                         return value.toLocaleDateString('pt-BR');
                     }
                     if (typeof value === 'string') {
                         // Escapar aspas duplas e envolver o campo em aspas se contiver ponto e vírgula ou aspas
                         const escapedValue = value.replace(/"/g, '""');
                         return escapedValue.includes(';') || escapedValue.includes('"') ? `"${escapedValue}"` : escapedValue;
                     }
                      if (typeof value === 'number') {
                         // Formatar números com vírgula como separador decimal
                         return String(value).replace('.', ',');
                      }
                     return String(value);
                });
                csvRows.push(values.join(';'));
            }

            // Criar Blob e link de download
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}.csv`;
            link.click();
         }

         async function exportAlunosToCSV() {
             showLoading();
             // Buscar todos os alunos (sem paginação) para exportação
             const result = await fetchItems('alunos', 1, '', {}); // Passa página 1 e sem termo/filtro para pegar todos
             hideLoading();
             if (result.data.length > 0) {
                 exportToCSV('alunos_export', result.data);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }

         async function exportProfessoresToCSV() {
             showLoading();
             const result = await fetchItems('professores', 1, '', {});
             hideLoading();
             if (result.data.length > 0) {
                 exportToCSV('professores_export', result.data);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }

         async function exportCursosToCSV() {
             showLoading();
             const result = await fetchItems('cursos', 1, '', {});
             hideLoading();
             if (result.data.length > 0) {
                 exportToCSV('cursos_export', result.data);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }

         async function exportTurmasToCSV() {
             showLoading();
             const result = await fetchItems('turmas', 1, '', {});
             hideLoading();
             if (result.data.length > 0) {
                  // Para turmas, substituir IDs por nomes no CSV
                 const turmasFormatted = result.data.map(turma => {
                     const curso = db.cursos.find(c => c.id === turma.cursoId);
                     const professor = db.professores.find(p => p.id === turma.professorId);
                     return {
                         ...turma,
                         cursoId: curso ? curso.nome : 'Desconhecido',
                         professorId: professor ? professor.nome : 'Desconhecido',
                         ativa: turma.ativa ? 'Sim' : 'Não'
                     };
                 });
                 exportToCSV('turmas_export', turmasFormatted);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }

         async function exportMatriculasToCSV() {
             showLoading();
             const result = await fetchItems('matriculas', 1, '', {});
             hideLoading();
             if (result.data.length > 0) {
                 // Para matrículas, substituir IDs por nomes no CSV
                 const matriculasFormatted = result.data.map(matricula => {
                     const aluno = db.alunos.find(a => a.id === matricula.alunoId);
                     const turma = db.turmas.find(t => t.id === matricula.turmaId);
                     return {
                         ...matricula,
                         alunoId: aluno ? aluno.nome : 'Desconhecido',
                         turmaId: turma ? turma.nome : 'Desconhecida',
                         dataMatricula: new Date(matricula.dataMatricula).toLocaleDateString('pt-BR')
                     };
                 });
                 exportToCSV('matriculas_export', matriculasFormatted);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }

         async function exportMensalidadesToCSV() {
             showLoading();
             const result = await fetchItems('mensalidades', 1, '', {});
             hideLoading();
             if (result.data.length > 0) {
                 // Para mensalidades, substituir ID da matrícula por info e formatar datas/valores
                 const mensalidadesFormatted = result.data.map(mensalidade => {
                     const matricula = db.matriculas.find(m => m.id === mensalidade.matriculaId);
                     const aluno = matricula ? db.alunos.find(a => a.id === matricula.alunoId) : null;
                     const turma = matricula ? db.turmas.find(t => t.id === matricula.turmaId) : null;
                     const matriculaInfo = matricula ? `${aluno ? aluno.nome : 'Aluno Desconhecido'} - ${turma ? turma.nome : 'Turma Desconhecida'}` : 'Matrícula Desconhecida';

                     return {
                         ...mensalidade,
                         matriculaId: matriculaInfo,
                         dataVencimento: new Date(mensalidade.dataVencimento).toLocaleDateString('pt-BR'),
                         valor: mensalidade.valor.toFixed(2).replace('.', ','),
                         dataPagamento: mensalidade.dataPagamento ? new Date(mensalidade.dataPagamento).toLocaleDateString('pt-BR') : ''
                     };
                 });
                 exportToCSV('mensalidades_export', mensalidadesFormatted);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }

         async function exportLeadsToCSV() {
             showLoading();
             const result = await fetchItems('leads', 1, '', {});
             hideLoading();
             if (result.data.length > 0) {
                  // Para leads, substituir ID do curso por nome
                 const leadsFormatted = result.data.map(lead => {
                     const curso = db.cursos.find(c => c.id === lead.cursoInteresse);
                     return {
                         ...lead,
                         cursoInteresse: curso ? curso.nome : 'Não especificado'
                     };
                 });
                 exportToCSV('leads_export', leadsFormatted);
             } else {
                 showNotification('Nenhum dado para exportar.', 'info');
             }
         }


        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos da sidebar
            const navDashboard = document.getElementById('navDashboard');
            const navAlunos = document.getElementById('navAlunos');
            const navProfessores = document.getElementById('navProfessores');
            const navCursos = document.getElementById('navCursos');
            const navTurmas = document.getElementById('navTurmas');
            const navMatriculas = document.getElementById('navMatriculas');
            const navMensalidades = document.getElementById('navMensalidades');
            const navLeads = document.getElementById('navLeads');
            const navReports = document.getElementById('navReports');
            const logoutButton = document.getElementById('logoutButton');

            // Elementos de busca e filtro
            const searchAlunoInput = document.getElementById('searchAlunoInput');
            const filterAlunoStatusSelect = document.getElementById('filterAlunoStatus');
            const searchProfessorInput = document.getElementById('searchProfessorInput');
            const filterProfessorStatusSelect = document.getElementById('filterProfessorStatus');
            const searchCursoInput = document.getElementById('searchCursoInput');
            const searchTurmaInput = document.getElementById('searchTurmaInput');
            const filterTurmaCursoSelect = document.getElementById('filterTurmaCurso');
            const filterTurmaProfessorSelect = document.getElementById('filterTurmaProfessor');
            const filterTurmaStatusSelect = document.getElementById('filterTurmaStatus');
            const searchMatriculaInput = document.getElementById('searchMatriculaInput');
            const filterMatriculaAlunoSelect = document.getElementById('filterMatriculaAluno');
            const filterMatriculaTurmaSelect = document.getElementById('filterMatriculaTurma');
            const filterMatriculaStatusSelect = document.getElementById('filterMatriculaStatus');
            const searchMensalidadeInput = document.getElementById('searchMensalidadeInput');
            const filterMensalidadeMatriculaSelect = document.getElementById('filterMensalidadeMatricula');
            const filterMensalidadeStatusSelect = document.getElementById('filterMensalidadeStatus');
            const searchLeadInput = document.getElementById('searchLeadInput');
            const filterLeadStatusSelect = document.getElementById('filterLeadStatus');
            const filterLeadCursoSelect = document.getElementById('filterLeadCurso');


            // Botões de adicionar
            const addAlunoButton = document.getElementById('addAlunoButton');
            const addProfessorButton = document.getElementById('addProfessorButton');
            const addCursoButton = document.getElementById('addCursoButton');
            const addTurmaButton = document.getElementById('addTurmaButton');
            const addMatriculaButton = document.getElementById('addMatriculaButton');
            const addMensalidadeButton = document.getElementById('addMensalidadeButton');
            const addLeadButton = document.getElementById('addLeadButton');

            // Botões de exportar
            const exportAlunosButton = document.getElementById('exportAlunosButton');
            const exportProfessoresButton = document.getElementById('exportProfessoresButton');
            const exportCursosButton = document.getElementById('exportCursosButton');
            const exportTurmasButton = document.getElementById('exportTurmasButton');
            const exportMatriculasButton = document.getElementById('exportMatriculasButton');
            const exportMensalidadesButton = document.getElementById('exportMensalidadesButton');
            const exportLeadsButton = document.getElementById('exportLeadsButton');


            // Elementos de paginação
            const prevAlunoPage = document.getElementById('prevAlunoPage');
            const nextAlunoPage = document.getElementById('nextAlunoPage');
            const prevProfessorPage = document.getElementById('prevProfessorPage');
            const nextProfessorPage = document.getElementById('nextProfessorPage');
            const prevCursoPage = document.getElementById('prevCursoPage');
            const nextCursoPage = document.getElementById('nextCursoPage');
            const prevTurmaPage = document.getElementById('prevTurmaPage');
            const nextTurmaPage = document.getElementById('nextTurmaPage');
            const prevMatriculaPage = document.getElementById('prevMatriculaPage');
            const nextMatriculaPage = document.getElementById('nextMatriculaPage');
            const prevMensalidadePage = document.getElementById('prevMensalidadePage');
            const nextMensalidadePage = document('nextMensalidadePage');
            const prevLeadPage = document.getElementById('prevLeadPage');
            const nextLeadPage = document.getElementById('nextLeadPage');


            // Elementos do modal Adicionar/Editar
            const closeItemModalButton = document.getElementById('closeItemModalButton');
            const cancelItemButton = document.getElementById('cancelItemButton');
            const itemForm = document.getElementById('itemForm');

             // Elementos do modal Visualizar Detalhes
            const closeViewModalButton = document.getElementById('closeViewModalButton');


            // Elementos do modal Confirmar Exclusão
            const closeDeleteModalButton = document.getElementById('closeDeleteModalButton');
            const cancelDeleteButton = document.getElementById('cancelDeleteButton');
            const confirmDeleteButton = document.getElementById('confirmDeleteButton');

             // Elementos dos Relatórios
             const reportStartDateInput = document.getElementById('reportStartDate');
             const reportEndDateInput = document.getElementById('reportEndDate');

             // Elementos do Dashboard
             const addActivityForm = document.getElementById('addActivityForm');


            // --- Event Listeners ---

            // Event listeners para busca e filtro de Alunos
            searchAlunoInput.addEventListener('input', () => {
                currentAlunoSearchTerm = searchAlunoInput.value.trim();
                currentAlunoPage = 1; // Volta para a primeira página ao buscar
                loadAlunos();
            });

            filterAlunoStatusSelect.addEventListener('change', () => {
                currentFilterAlunoStatus = filterAlunoStatusSelect.value;
                currentAlunoPage = 1; // Volta para a primeira página ao filtrar
                loadAlunos();
            });

            // Event listeners para busca e filtro de Professores
            searchProfessorInput.addEventListener('input', () => {
                currentProfessorSearchTerm = searchProfessorInput.value.trim();
                currentProfessorPage = 1; // Volta para a primeira página ao buscar
                loadProfessores();
            });

            filterProfessorStatusSelect.addEventListener('change', () => {
                currentFilterProfessorStatus = filterProfessorStatusSelect.value;
                currentProfessorPage = 1; // Volta para a primeira página ao filtrar
                loadProfessores();
            });

             // Event listeners para busca de Cursos
            searchCursoInput.addEventListener('input', () => {
                currentCursoSearchTerm = searchCursoInput.value.trim();
                currentCursoPage = 1; // Volta para a primeira página ao buscar
                loadCursos();
            });

             // Event listeners para busca e filtro de Turmas
            searchTurmaInput.addEventListener('input', () => {
                currentTurmaSearchTerm = searchTurmaInput.value.trim();
                currentTurmaPage = 1; // Volta para a primeira página ao buscar
                loadTurmas();
            });

            filterTurmaCursoSelect.addEventListener('change', () => {
                currentFilterTurmaCurso = filterTurmaCursoSelect.value; // O valor é o ID do curso (string)
                currentTurmaPage = 1; // Volta para a primeira página ao filtrar
                loadTurmas();
            });

             filterTurmaProfessorSelect.addEventListener('change', () => {
                currentFilterTurmaProfessor = filterTurmaProfessorSelect.value; // O valor é o ID do professor (string)
                currentTurmaPage = 1; // Volta para a primeira página ao filtrar
                loadTurmas();
            });

            filterTurmaStatusSelect.addEventListener('change', () => {
                currentFilterTurmaStatus = filterTurmaStatusSelect.value; // O valor é 'true', 'false' ou ''
                currentTurmaPage = 1; // Volta para a primeira página ao filtrar
                loadTurmas();
            });

             // Event listeners para busca e filtro de Matrículas
            searchMatriculaInput.addEventListener('input', () => {
                currentMatriculaSearchTerm = searchMatriculaInput.value.trim();
                currentMatriculaPage = 1; // Volta para a primeira página ao buscar
                loadMatriculas(); // Note: Busca por texto não é aplicada no fetch simulado para esta coleção
            });

            filterMatriculaAlunoSelect.addEventListener('change', () => {
                currentFilterMatriculaAluno = filterMatriculaAlunoSelect.value; // O valor é o ID do aluno (string)
                currentMatriculaPage = 1; // Volta para a primeira página ao filtrar
                loadMatriculas();
            });

             filterMatriculaTurmaSelect.addEventListener('change', () => {
                currentFilterMatriculaTurma = filterMatriculaTurmaSelect.value; // O valor é o ID da turma (string)
                currentMatriculaPage = 1; // Volta para a primeira página ao filtrar
                loadMatriculas();
            });

            filterMatriculaStatusSelect.addEventListener('change', () => {
                currentFilterMatriculaStatus = filterMatriculaStatusSelect.value; // O valor é o status
                currentMatriculaPage = 1; // Volta para a primeira página ao filtrar
                loadMatriculas();
            });

             // Event listeners para busca e filtro de Mensalidades
            searchMensalidadeInput.addEventListener('input', () => {
                currentMensalidadeSearchTerm = searchMensalidadeInput.value.trim();
                currentMensalidadePage = 1; // Volta para a primeira página ao buscar
                loadMensalidades(); // Note: Busca por texto não é aplicada no fetch simulado para esta coleção
            });

            filterMensalidadeMatriculaSelect.addEventListener('change', () => {
                currentFilterMensalidadeMatricula = filterMensalidadeMatriculaSelect.value; // O valor é o ID da matrícula (string)
                currentMensalidadePage = 1; // Volta para a primeira página ao filtrar
                loadMensalidades();
            });

            filterMensalidadeStatusSelect.addEventListener('change', () => {
                currentFilterMensalidadeStatus = filterMensalidadeStatusSelect.value; // O valor é o status
                currentMensalidadePage = 1; // Volta para a primeira página ao filtrar
                loadMensalidades();
            });

             // Event listeners para busca e filtro de Leads
            searchLeadInput.addEventListener('input', () => {
                currentLeadSearchTerm = searchLeadInput.value.trim();
                currentLeadPage = 1; // Volta para a primeira página ao buscar
                loadLeads();
            });

            filterLeadStatusSelect.addEventListener('change', () => {
                currentFilterLeadStatus = filterLeadStatusSelect.value; // O valor é o status
                currentLeadPage = 1; // Volta para a primeira página ao filtrar
                loadLeads();
            });

             filterLeadCursoSelect.addEventListener('change', () => {
                currentFilterLeadCurso = filterLeadCursoSelect.value; // O valor é o ID do curso (string)
                currentLeadPage = 1; // Volta para a primeira página ao filtrar
                loadLeads();
            });


            // Event listeners para abrir modais de adicionar
            addAlunoButton.addEventListener('click', () => openAddEditModal('add', 'alunos'));
            addProfessorButton.addEventListener('click', () => openAddEditModal('add', 'professores'));
            addCursoButton.addEventListener('click', () => openAddEditModal('add', 'cursos'));
            addTurmaButton.addEventListener('click', () => openAddEditModal('add', 'turmas'));
            addMatriculaButton.addEventListener('click', () => openAddEditModal('add', 'matriculas'));
            addMensalidadeButton.addEventListener('click', () => openAddEditModal('add', 'mensalidades'));
            addLeadButton.addEventListener('click', () => openAddEditModal('add', 'leads'));

             // Event listeners para botões de exportar
            exportAlunosButton.addEventListener('click', exportAlunosToCSV);
            exportProfessoresButton.addEventListener('click', exportProfessoresToCSV);
            exportCursosButton.addEventListener('click', exportCursosToCSV);
            exportTurmasButton.addEventListener('click', exportTurmasToCSV);
            exportMatriculasButton.addEventListener('click', exportMatriculasToCSV);
            exportMensalidadesButton.addEventListener('click', exportMensalidadesToCSV);
            exportLeadsButton.addEventListener('click', exportLeadsToCSV);


            // Event listeners para navegação na sidebar
            navDashboard.addEventListener('click', (e) => { e.preventDefault(); showSection('dashboardSection'); });
            navAlunos.addEventListener('click', (e) => { e.preventDefault(); showSection('alunosSection'); });
            navProfessores.addEventListener('click', (e) => { e.preventDefault(); showSection('professoresSection'); });
            navCursos.addEventListener('click', (e) => { e.preventDefault(); showSection('cursosSection'); });
            navTurmas.addEventListener('click', (e) => { e.preventDefault(); showSection('turmasSection'); });
            navMatriculas.addEventListener('click', (e) => { e.preventDefault(); showSection('matriculasSection'); });
            navMensalidades.addEventListener('click', (e) => { e.preventDefault(); showSection('mensalidadesSection'); });
            navLeads.addEventListener('click', (e) => { e.preventDefault(); showSection('leadsSection'); });
            navReports.addEventListener('click', (e) => { e.preventDefault(); showSection('reportsSection'); });


            // Event listeners para paginação de Alunos
            prevAlunoPage.addEventListener('click', () => {
                if (currentAlunoPage > 1) {
                    currentAlunoPage--;
                    loadAlunos();
                }
            });
            nextAlunoPage.addEventListener('click', () => {
                if (currentAlunoPage < totalAlunoPages) {
                    currentAlunoPage++;
                    loadAlunos();
                }
            });

             // Event listeners para paginação de Professores
            prevProfessorPage.addEventListener('click', () => {
                if (currentProfessorPage > 1) {
                    currentProfessorPage--;
                    loadProfessores();
                }
            });
            nextProfessorPage.addEventListener('click', () => {
                if (currentProfessorPage < totalProfessorPages) {
                    currentProfessorPage++;
                    loadProfessores();
                }
            });

             // Event listeners para paginação de Cursos
            prevCursoPage.addEventListener('click', () => {
                if (currentCursoPage > 1) {
                    currentCursoPage--;
                    loadCursos();
                }
            });
            nextCursoPage.addEventListener('click', () => {
                if (currentCursoPage < totalCursoPages) {
                    currentCursoPage++;
                    loadCursos();
                }
            });

             // Event listeners para paginação de Turmas
            prevTurmaPage.addEventListener('click', () => {
                if (currentTurmaPage > 1) {
                    currentTurmaPage--;
                    loadTurmas();
                }
            });
            nextTurmaPage.addEventListener('click', () => {
                if (currentTurmaPage < totalTurmaPages) {
                    currentTurmaPage++;
                    loadTurmas();
                }
            });

             // Event listeners para paginação de Matrículas
            prevMatriculaPage.addEventListener('click', () => {
                if (currentMatriculaPage > 1) {
                    currentMatriculaPage--;
                    loadMatriculas();
                }
            });
            nextMatriculaPage.addEventListener('click', () => {
                if (currentMatriculaPage < totalMatriculaPages) {
                    currentMatriculaPage++;
                    loadMatriculas();
                }
            });

             // Event listeners para paginação de Mensalidades
            prevMensalidadePage.addEventListener('click', () => {
                if (currentMensalidadePage > 1) {
                    currentMensalidadePage--;
                    loadMensalidades();
                }
            });
            nextMensalidadePage.addEventListener('click', () => {
                if (currentMensalidadePage < totalMensalidadePages) {
                    currentMensalidadePage++;
                    loadMensalidades();
                }
            });

             // Event listeners para paginação de Leads
            prevLeadPage.addEventListener('click', () => {
                if (currentLeadPage > 1) {
                    currentLeadPage--;
                    loadLeads();
                }
            }
            );
            nextLeadPage.addEventListener('click', () => {
                if (currentLeadPage < totalLeadPages) {
                    currentLeadPage++;
                    loadLeads();
                }
            });


            // Event listener para o botão Sair
            logoutButton.addEventListener('click', handleLogout);

            // Event listeners para fechar modais
            closeItemModalButton.addEventListener('click', closeItemModal);
            cancelItemButton.addEventListener('click', closeItemModal);
             closeViewModalButton.addEventListener('click', closeViewModal); // Adicionado listener para fechar modal de visualização

             // Event listeners para o modal de exclusão
             closeDeleteModalButton.addEventListener('click', closeDeleteConfirmModal);
             cancelDeleteButton.addEventListener('click', closeDeleteConfirmModal);
             confirmDeleteButton.addEventListener('click', handleConfirmDelete);

             // Event listener para o formulário de adicionar/editar item
             itemForm.addEventListener('submit', handleItemFormSubmit);


             // Event listeners para os filtros de data dos relatórios
             reportStartDateInput.addEventListener('change', loadReports);
             reportEndDateInput.addEventListener('change', loadReports);

             // Adiciona event listener para o formulário de adicionar atividade no Dashboard
             addActivityForm.addEventListener('submit', handleAddActivitySubmit);

             // Adiciona event listener delegado para os botões "Marcar como Pago" na tabela de mensalidades
             document.getElementById('mensalidadesTableBody').addEventListener('click', (event) => {
                 const target = event.target;
                 // Verifica se o clique foi em um botão "Marcar como Pago" ou em seu ícone/texto
                 const button = target.closest('.text-green-600');
                 if (button && button.textContent.includes('Pagar')) {
                     const mensalidadeId = parseInt(button.dataset.id); // Assume que o ID será armazenado em data-id
                     if (!isNaN(mensalidadeId)) {
                         markMensalidadeAsPaid(mensalidadeId);
                     }
                 }
             });


            // Executa a verificação de autenticação e role ao carregar a página
            checkAuthAndRole();
            // Define as datas padrão dos relatórios ao carregar a página
            setDefaultReportDates();


        });


    </script>

</body>
</html>
